"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_extra_1 = __importDefault(require("fs-extra"));
const path_1 = __importDefault(require("path"));
const node_xlsx_1 = __importDefault(require("node-xlsx"));
const uuid_1 = __importDefault(require("./uuid"));
class Tools {
    static hello() {
        console.log("hello");
    }
    /**
     * 针对element进行排序
     * @param array
     * @param fields
     */
    static sortArrayByField(array, fields) {
        // 重载，允许只有一个字符串
        // cc.log("---typeof( fields )=",typeof( fields ))
        if (typeof (fields) == "string") {
            fields = [fields];
        }
        else {
            fields = fields;
        }
        // 处理一次fields
        let fieldConfig = [];
        for (let k in fields) {
            let v = fields[k];
            if (v && v != "") {
                // cc.log(v)
                if (v.substring(0, 1) === "-") {
                    let tmpField = v.substring(1, v.length);
                    if (tmpField && tmpField != "") {
                        fieldConfig.push([tmpField, true]);
                    }
                }
                else {
                    fieldConfig.push([v, false]);
                }
            }
        }
        // -- 按照优先级进行排序
        let sorter = (a, b) => {
            let ret = 0;
            for (let k in fieldConfig) {
                let v = fieldConfig[k];
                let field = v[0];
                let desc = v[1];
                let v1 = a[field];
                let v2 = b[field];
                if (v1 != null) {
                    if (desc) {
                        ret = v2 - v1;
                    }
                    else {
                        ret = v1 - v2;
                    }
                    if (ret != 0) {
                        return ret;
                    }
                }
            }
            return ret;
        };
        let sorted = [];
        for (let i = 0; i < array.length; i++) {
            const v = array[i];
            sorted.push(v);
        }
        sorted.sort(sorter);
        return sorted;
    }
    static _convert(match, nosign) {
        if (nosign) {
            match.sign = '';
        }
        else {
            match.sign = match.negative ? '-' : match.sign;
        }
        var l = match.min - match.argument.length + 1 - match.sign.length;
        var pad = new Array(l < 0 ? 0 : l).join(match.pad);
        if (!match.left) {
            if (match.pad == "0" || nosign) {
                return match.sign + pad + match.argument;
            }
            else {
                return pad + match.sign + match.argument;
            }
        }
        else {
            if (match.pad == "0" || nosign) {
                return match.sign + match.argument + pad.replace(/0/g, ' ');
            }
            else {
                return match.sign + match.argument + pad;
            }
        }
    }
    static format() {
        if (typeof arguments == "undefined") {
            return null;
        }
        if (arguments.length < 1) {
            return null;
        }
        if (typeof arguments[0] != "string") {
            return null;
        }
        if (typeof RegExp == "undefined") {
            return null;
        }
        var string = arguments[0];
        var exp = new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g);
        var matches = new Array();
        var strings = new Array();
        var convCount = 0;
        var stringPosStart = 0;
        var stringPosEnd = 0;
        var matchPosEnd = 0;
        var newString = '';
        var match = null;
        while (match = exp.exec(string)) {
            if (match[9]) {
                convCount += 1;
            }
            stringPosStart = matchPosEnd;
            stringPosEnd = exp.lastIndex - match[0].length;
            strings[strings.length] = string.substring(stringPosStart, stringPosEnd);
            matchPosEnd = exp.lastIndex;
            matches[matches.length] = {
                match: match[0],
                left: match[3] ? true : false,
                sign: match[4] || '',
                pad: match[5] || ' ',
                min: match[6] || 0,
                precision: match[8],
                code: match[9] || '%',
                negative: parseInt(arguments[convCount]) < 0 ? true : false,
                argument: String(arguments[convCount])
            };
        }
        strings[strings.length] = string.substring(matchPosEnd);
        if (matches.length == 0) {
            return string;
        }
        if ((arguments.length - 1) < convCount) {
            return null;
        }
        var code = null;
        var match = null;
        var substitution = null;
        var i = null;
        for (i = 0; i < matches.length; i++) {
            if (matches[i].code == '%') {
                substitution = '%';
            }
            else if (matches[i].code == 'b') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)).toString(2));
                substitution = this._convert(matches[i], true);
            }
            else if (matches[i].code == 'c') {
                matches[i].argument = String(String.fromCharCode(Math.abs(parseInt(matches[i].argument))));
                substitution = this._convert(matches[i], true);
            }
            else if (matches[i].code == 'd') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)));
                substitution = this._convert(matches[i]);
            }
            else if (matches[i].code == 'f') {
                matches[i].argument = String(Math.abs(parseFloat(matches[i].argument)).toFixed(matches[i].precision ? matches[i].precision : 6));
                substitution = this._convert(matches[i]);
            }
            else if (matches[i].code == 'o') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)).toString(8));
                substitution = this._convert(matches[i]);
            }
            else if (matches[i].code == 's') {
                matches[i].argument = matches[i].argument.substring(0, matches[i].precision ? matches[i].precision : matches[i].argument.length);
                substitution = this._convert(matches[i], true);
            }
            else if (matches[i].code == 'x') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)).toString(16));
                substitution = this._convert(matches[i]);
            }
            else if (matches[i].code == 'X') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)).toString(16));
                substitution = this._convert(matches[i]).toUpperCase();
            }
            else {
                substitution = matches[i].match;
            }
            newString += strings[i];
            newString += substitution;
        }
        newString += strings[i];
        return newString;
    }
    /**
     * 遍历[key-value]结构的map
     * @param map
     * @param callback return tuue：中断循环
     */
    static forEachMap(map, callback) {
        if (!map)
            return;
        let keys = Object.keys(map);
        keys = keys.sort();
        for (let i = 0; i < keys.length; i++) {
            let key = keys[i];
            let value = map[key];
            if (value != null) {
                if (callback(key, value))
                    break;
            }
        }
    }
    /**
     * 遍历数据结构，返回长度
     * @param obj 数组 or obj
     */
    static getObjSize(obj) {
        if (!obj) {
            return 0;
        }
        if (Array.isArray(obj)) {
            return obj.length;
        }
        let count = 0;
        Tools.forEachMap(obj, (k, v) => {
            count++;
        });
        return count;
    }
    static foreachDir(dir, callback, bNotRecursion) {
        if (!fs_extra_1.default.existsSync(dir)) {
            console.error("找不到指定文件夹：", dir);
            return;
        }
        fs_extra_1.default.readdirSync(dir).forEach((fileName) => {
            if (fileName.startsWith("~")) {
                // 忽略隐藏文件
                return;
            }
            let pathName = path_1.default.join(dir, fileName);
            try {
                if (fs_extra_1.default.statSync(pathName).isDirectory() && bNotRecursion != true) {
                    this.foreachDir(pathName, callback, bNotRecursion);
                }
                else {
                    callback(path_1.default.normalize(pathName));
                }
            }
            catch (error) {
                console.error(error);
            }
        });
    }
    static foreachDirs(dirs, callback) {
        if (!Array.isArray(dirs)) {
            console.error("Tools.foreachDirs dirs not array!");
            return;
        }
        for (let dir of dirs) {
            this.foreachDir(dir, callback, false);
        }
    }
    /**
     * 加载xlsx数据
     * @param {*} filePath
     * @return [
     *      sheetNames: string[],
     *      sheetDatas: string[][],
     * ]
     */
    static loadRawDatasFromXlsx(filePath) {
        let sheets = node_xlsx_1.default.parse(filePath);
        let rawDatas = [];
        for (let i = 0; i < sheets.length; i++) {
            const sheet = sheets[i];
            rawDatas.push({
                name: sheet.name,
                data: sheet.data,
            });
        }
        return rawDatas;
    }
    /**
     * 计算两个path的相对目录
     * 如：
     * path1 = D:\ude2\prj.ulcocoscreator_sample3.5.2\assets\scripts\game\view\prefab_test\PrefabBb.ts
     * path2 = D:\ude2\prj.ulcocoscreator_sample3.5.2\assets\scripts\ulframework\view\PrefabBase.ts
     * return -> ../../../ulframework/view
     */
    static calcRelativePath(path1, path2) {
        path1 = path_1.default.normalize(path1);
        path2 = path_1.default.normalize(path2);
        //console.log("path1 = ",path1);
        //console.log("path2 = ",path2);
        // 当前位置
        let arr1 = path1.split(path_1.default.sep);
        // 目标位置
        let arr2 = path2.split(path_1.default.sep);
        let arr = [];
        for (let i = 0; i < Math.min(arr1.length, arr2.length); i++) {
            let f1 = arr1[i];
            let f2 = arr2[i];
            if (f1 != f2) {
                // 将当前位置剩余的字段替换为 ..
                for (let j = i + 1; j < arr1.length; j++) {
                    arr.push("..");
                }
                // 将目标位置剩余的字段压栈
                for (let j = i; j < arr2.length; j++) {
                    arr.push(arr2[j]);
                }
                break;
            }
        }
        if (arr.length == 1) {
            return "./" + arr[0];
        }
        return arr.join(path_1.default.sep);
    }
    static findLineTag(lines, beginTag, endTag) {
        let index1 = null;
        let index2 = null;
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line == beginTag) {
                index1 = i;
            }
            else if (line == endTag) {
                index2 = i;
            }
        }
        return [index1, index2];
    }
    static loadRawDatasFromXlsxAsync(filePath, cb) {
        let rawDatas = this.loadRawDatasFromXlsx(filePath);
        cb(rawDatas);
    }
    ///// uuid相关 /////
    static loadUuidFromMetaFilePath(metaFilePath) {
        try {
            let text = fs_extra_1.default.readFileSync(metaFilePath, { encoding: "utf-8" });
            let data = JSON.parse(text);
            return data.uuid;
        }
        catch (error) {
            console.error("Tools.loadUuidFromMetaFilePath has error", error);
            return null;
        }
    }
    static compressUuid(uuid) {
        return uuid_1.default.compressUuid(uuid);
    }
    static decompressUuid(uuid) {
        return uuid_1.default.decompressUuid(uuid);
    }
}
exports.default = Tools;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHMgY29weS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZS91dGlscy90b29scyBjb3B5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsd0RBQTBCO0FBQzFCLGdEQUF3QjtBQUN4QiwwREFBNkI7QUFDN0Isa0RBQTBCO0FBRzFCLE1BQXFCLEtBQUs7SUFDdEIsTUFBTSxDQUFDLEtBQUs7UUFDUixPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ3hCLENBQUM7SUFJRDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxNQUFNO1FBQ2pDLGVBQWU7UUFDZixrREFBa0Q7UUFDbEQsSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksUUFBUSxFQUFFO1lBQzdCLE1BQU0sR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3JCO2FBQU07WUFDSCxNQUFNLEdBQUcsTUFBTSxDQUFDO1NBQ25CO1FBRUQsYUFBYTtRQUNiLElBQUksV0FBVyxHQUFHLEVBQUUsQ0FBQztRQUNyQixLQUFLLElBQUksQ0FBQyxJQUFJLE1BQU0sRUFBRTtZQUNsQixJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRTtnQkFDZCxZQUFZO2dCQUNaLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssR0FBRyxFQUFFO29CQUMzQixJQUFJLFFBQVEsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQ3hDLElBQUksUUFBUSxJQUFJLFFBQVEsSUFBSSxFQUFFLEVBQUU7d0JBQzVCLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztxQkFDdEM7aUJB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QUssQ0FBQyxDQUFDO1lBQ2pFLE9BQU8sSUFBSSxDQUFDO1NBQ2Y7SUFDTCxDQUFDO0lBRUQsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJO1FBQ3BCLE9BQU8sY0FBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJO1FBQ3RCLE9BQU8sY0FBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNyQyxDQUFDO0NBRUo7QUFyWEQsd0JBcVhDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gXCJmcy1leHRyYVwiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB4bHN4IGZyb20gXCJub2RlLXhsc3hcIjtcbmltcG9ydCBVdWlkIGZyb20gXCIuL3V1aWRcIjtcblxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUb29scyB7XG4gICAgc3RhdGljIGhlbGxvKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImhlbGxvXCIpXG4gICAgfVxuXG4gICAgXG5cbiAgICAvKipcbiAgICAgKiDpkojlr7llbGVtZW506L+b6KGM5o6S5bqPXG4gICAgICogQHBhcmFtIGFycmF5IFxuICAgICAqIEBwYXJhbSBmaWVsZHMgXG4gICAgICovXG4gICAgc3RhdGljIHNvcnRBcnJheUJ5RmllbGQoYXJyYXksIGZpZWxkcykge1xuICAgICAgICAvLyDph43ovb3vvIzlhYHorrjlj6rmnInkuIDkuKrlrZfnrKbkuLJcbiAgICAgICAgLy8gY2MubG9nKFwiLS0tdHlwZW9mKCBmaWVsZHMgKT1cIix0eXBlb2YoIGZpZWxkcyApKVxuICAgICAgICBpZiAodHlwZW9mIChmaWVsZHMpID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIGZpZWxkcyA9IFtmaWVsZHNdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZmllbGRzID0gZmllbGRzO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5aSE55CG5LiA5qyhZmllbGRzXG4gICAgICAgIGxldCBmaWVsZENvbmZpZyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBrIGluIGZpZWxkcykge1xuICAgICAgICAgICAgbGV0IHYgPSBmaWVsZHNba107XG4gICAgICAgICAgICBpZiAodiAmJiB2ICE9IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAvLyBjYy5sb2codilcbiAgICAgICAgICAgICAgICBpZiAodi5zdWJzdHJpbmcoMCwgMSkgPT09IFwiLVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCB0bXBGaWVsZCA9IHYuc3Vic3RyaW5nKDEsIHYubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRtcEZpZWxkICYmIHRtcEZpZWxkICE9IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkQ29uZmlnLnB1c2goW3RtcEZpZWxkLCB0cnVlXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkQ29uZmlnLnB1c2goW3YsIGZhbHNlXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gLS0g5oyJ54Wn5LyY5YWI57qn6L+b6KGM5o6S5bqPXG4gICAgICAgIGxldCBzb3J0ZXIgPSAoYSwgYikgPT4ge1xuICAgICAgICAgICAgbGV0IHJldCA9IDBcblxuICAgICAgICAgICAgZm9yIChsZXQgayBpbiBmaWVsZENvbmZpZykge1xuICAgICAgICAgICAgICAgIGxldCB2ID0gZmllbGRDb25maWdba107XG4gICAgICAgICAgICAgICAgbGV0IGZpZWxkID0gdlswXTtcbiAgICAgICAgICAgICAgICBsZXQgZGVzYyA9IHZbMV07XG5cbiAgICAgICAgICAgICAgICBsZXQgdjEgPSBhW2ZpZWxkXTtcbiAgICAgICAgICAgICAgICBsZXQgdjIgPSBiW2ZpZWxkXTtcbiAgICAgICAgICAgICAgICBpZiAodjEgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGVzYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gdjIgLSB2MTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IHYxIC0gdjI7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAocmV0ICE9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHNvcnRlZCA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCB2ID0gYXJyYXlbaV07XG4gICAgICAgICAgICBzb3J0ZWQucHVzaCh2KTtcbiAgICAgICAgfVxuICAgICAgICBzb3J0ZWQuc29ydChzb3J0ZXIpO1xuICAgICAgICByZXR1cm4gc29ydGVkXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgX2NvbnZlcnQobWF0Y2g/LCBub3NpZ24/KSB7XG4gICAgICAgIGlmIChub3NpZ24pIHtcbiAgICAgICAgICAgIG1hdGNoLnNpZ24gPSAnJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1hdGNoLnNpZ24gPSBtYXRjaC5uZWdhdGl2ZSA/ICctJyA6IG1hdGNoLnNpZ247XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGwgPSBtYXRjaC5taW4gLSBtYXRjaC5hcmd1bWVudC5sZW5ndGggKyAxIC0gbWF0Y2guc2lnbi5sZW5ndGg7XG4gICAgICAgIHZhciBwYWQgPSBuZXcgQXJyYXkobCA8IDAgPyAwIDogbCkuam9pbihtYXRjaC5wYWQpO1xuICAgICAgICBpZiAoIW1hdGNoLmxlZnQpIHtcbiAgICAgICAgICAgIGlmIChtYXRjaC5wYWQgPT0gXCIwXCIgfHwgbm9zaWduKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoLnNpZ24gKyBwYWQgKyBtYXRjaC5hcmd1bWVudDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhZCArIG1hdGNoLnNpZ24gKyBtYXRjaC5hcmd1bWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChtYXRjaC5wYWQgPT0gXCIwXCIgfHwgbm9zaWduKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoLnNpZ24gKyBtYXRjaC5hcmd1bWVudCArIHBhZC5yZXBsYWNlKC8wL2csICcgJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaC5zaWduICsgbWF0Y2guYXJndW1lbnQgKyBwYWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDmoLzlvI/ljJblrZfnrKbkuLJcbiAgICAgKiBAcGFyYW0gYXJncyBj6aOO5qC855qEZm9ybWF05Y+C5pWw77yaZm9ybWF0KFwiJTAyZC0lc1wiLCAxLCBcImFcIilcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGZvcm1hdCguLi5hcmdzKTogc3RyaW5nO1xuICAgIHB1YmxpYyBzdGF0aWMgZm9ybWF0KCk6IHN0cmluZyB7XG4gICAgICAgIGlmICh0eXBlb2YgYXJndW1lbnRzID09IFwidW5kZWZpbmVkXCIpIHsgcmV0dXJuIG51bGw7IH1cbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxKSB7IHJldHVybiBudWxsOyB9XG4gICAgICAgIGlmICh0eXBlb2YgYXJndW1lbnRzWzBdICE9IFwic3RyaW5nXCIpIHsgcmV0dXJuIG51bGw7IH1cbiAgICAgICAgaWYgKHR5cGVvZiBSZWdFeHAgPT0gXCJ1bmRlZmluZWRcIikgeyByZXR1cm4gbnVsbDsgfVxuICAgICAgICB2YXIgc3RyaW5nID0gYXJndW1lbnRzWzBdO1xuICAgICAgICB2YXIgZXhwID0gbmV3IFJlZ0V4cCgvKCUoWyVdfChcXC0pPyhcXCt8XFx4MjApPygwKT8oXFxkKyk/KFxcLihcXGQpPyk/KFtiY2Rmb3N4WF0pKSkvZyk7XG4gICAgICAgIHZhciBtYXRjaGVzID0gbmV3IEFycmF5KCk7XG4gICAgICAgIHZhciBzdHJpbmdzID0gbmV3IEFycmF5KCk7XG4gICAgICAgIHZhciBjb252Q291bnQgPSAwO1xuICAgICAgICB2YXIgc3RyaW5nUG9zU3RhcnQgPSAwO1xuICAgICAgICB2YXIgc3RyaW5nUG9zRW5kID0gMDtcbiAgICAgICAgdmFyIG1hdGNoUG9zRW5kID0gMDtcbiAgICAgICAgdmFyIG5ld1N0cmluZyA9ICcnO1xuICAgICAgICB2YXIgbWF0Y2ggPSBudWxsO1xuICAgICAgICB3aGlsZSAobWF0Y2ggPSBleHAuZXhlYyhzdHJpbmcpKSB7XG4gICAgICAgICAgICBpZiAobWF0Y2hbOV0pIHsgY29udkNvdW50ICs9IDE7IH1cbiAgICAgICAgICAgIHN0cmluZ1Bvc1N0YXJ0ID0gbWF0Y2hQb3NFbmQ7XG4gICAgICAgICAgICBzdHJpbmdQb3NFbmQgPSBleHAubGFzdEluZGV4IC0gbWF0Y2hbMF0ubGVuZ3RoO1xuICAgICAgICAgICAgc3RyaW5nc1tzdHJpbmdzLmxlbmd0aF0gPSBzdHJpbmcuc3Vic3RyaW5nKHN0cmluZ1Bvc1N0YXJ0LCBzdHJpbmdQb3NFbmQpO1xuICAgICAgICAgICAgbWF0Y2hQb3NFbmQgPSBleHAubGFzdEluZGV4O1xuICAgICAgICAgICAgbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aF0gPSB7XG4gICAgICAgICAgICAgICAgbWF0Y2g6IG1hdGNoWzBdLFxuICAgICAgICAgICAgICAgIGxlZnQ6IG1hdGNoWzNdID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHNpZ246IG1hdGNoWzRdIHx8ICcnLFxuICAgICAgICAgICAgICAgIHBhZDogbWF0Y2hbNV0gfHwgJyAnLFxuICAgICAgICAgICAgICAgIG1pbjogbWF0Y2hbNl0gfHwgMCxcbiAgICAgICAgICAgICAgICBwcmVjaXNpb246IG1hdGNoWzhdLFxuICAgICAgICAgICAgICAgIGNvZGU6IG1hdGNoWzldIHx8ICclJyxcbiAgICAgICAgICAgICAgICBuZWdhdGl2ZTogcGFyc2VJbnQoYXJndW1lbnRzW2NvbnZDb3VudF0pIDwgMCA/IHRydWUgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBhcmd1bWVudDogU3RyaW5nKGFyZ3VtZW50c1tjb252Q291bnRdKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBzdHJpbmdzW3N0cmluZ3MubGVuZ3RoXSA9IHN0cmluZy5zdWJzdHJpbmcobWF0Y2hQb3NFbmQpO1xuICAgICAgICBpZiAobWF0Y2hlcy5sZW5ndGggPT0gMCkgeyByZXR1cm4gc3RyaW5nOyB9XG4gICAgICAgIGlmICgoYXJndW1lbnRzLmxlbmd0aCAtIDEpIDwgY29udkNvdW50KSB7IHJldHVybiBudWxsOyB9XG4gICAgICAgIHZhciBjb2RlID0gbnVsbDtcbiAgICAgICAgdmFyIG1hdGNoID0gbnVsbDtcbiAgICAgICAgdmFyIHN1YnN0aXR1dGlvbiA9IG51bGw7XG4gICAgICAgIHZhciBpID0gbnVsbDtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IG1hdGNoZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJyUnKSB7IHN1YnN0aXR1dGlvbiA9ICclJyB9XG4gICAgICAgICAgICBlbHNlIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJ2InKSB7XG4gICAgICAgICAgICAgICAgbWF0Y2hlc1tpXS5hcmd1bWVudCA9IFN0cmluZyhNYXRoLmFicyhwYXJzZUludChtYXRjaGVzW2ldLmFyZ3VtZW50KSkudG9TdHJpbmcoMikpO1xuICAgICAgICAgICAgICAgIHN1YnN0aXR1dGlvbiA9IHRoaXMuX2NvbnZlcnQobWF0Y2hlc1tpXSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJ2MnKSB7XG4gICAgICAgICAgICAgICAgbWF0Y2hlc1tpXS5hcmd1bWVudCA9IFN0cmluZyhTdHJpbmcuZnJvbUNoYXJDb2RlKE1hdGguYWJzKHBhcnNlSW50KG1hdGNoZXNbaV0uYXJndW1lbnQpKSkpO1xuICAgICAgICAgICAgICAgIHN1YnN0aXR1dGlvbiA9IHRoaXMuX2NvbnZlcnQobWF0Y2hlc1tpXSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJ2QnKSB7XG4gICAgICAgICAgICAgICAgbWF0Y2hlc1tpXS5hcmd1bWVudCA9IFN0cmluZyhNYXRoLmFicyhwYXJzZUludChtYXRjaGVzW2ldLmFyZ3VtZW50KSkpO1xuICAgICAgICAgICAgICAgIHN1YnN0aXR1dGlvbiA9IHRoaXMuX2NvbnZlcnQobWF0Y2hlc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJ2YnKSB7XG4gICAgICAgICAgICAgICAgbWF0Y2hlc1tpXS5hcmd1bWVudCA9IFN0cmluZyhNYXRoLmFicyhwYXJzZUZsb2F0KG1hdGNoZXNbaV0uYXJndW1lbnQpKS50b0ZpeGVkKG1hdGNoZXNbaV0ucHJlY2lzaW9uID8gbWF0Y2hlc1tpXS5wcmVjaXNpb24gOiA2KSk7XG4gICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gdGhpcy5fY29udmVydChtYXRjaGVzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG1hdGNoZXNbaV0uY29kZSA9PSAnbycpIHtcbiAgICAgICAgICAgICAgICBtYXRjaGVzW2ldLmFyZ3VtZW50ID0gU3RyaW5nKE1hdGguYWJzKHBhcnNlSW50KG1hdGNoZXNbaV0uYXJndW1lbnQpKS50b1N0cmluZyg4KSk7XG4gICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gdGhpcy5fY29udmVydChtYXRjaGVzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG1hdGNoZXNbaV0uY29kZSA9PSAncycpIHtcbiAgICAgICAgICAgICAgICBtYXRjaGVzW2ldLmFyZ3VtZW50ID0gbWF0Y2hlc1tpXS5hcmd1bWVudC5zdWJzdHJpbmcoMCwgbWF0Y2hlc1tpXS5wcmVjaXNpb24gPyBtYXRjaGVzW2ldLnByZWNpc2lvbiA6IG1hdGNoZXNbaV0uYXJndW1lbnQubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHN1YnN0aXR1dGlvbiA9IHRoaXMuX2NvbnZlcnQobWF0Y2hlc1tpXSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJ3gnKSB7XG4gICAgICAgICAgICAgICAgbWF0Y2hlc1tpXS5hcmd1bWVudCA9IFN0cmluZyhNYXRoLmFicyhwYXJzZUludChtYXRjaGVzW2ldLmFyZ3VtZW50KSkudG9TdHJpbmcoMTYpKTtcbiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSB0aGlzLl9jb252ZXJ0KG1hdGNoZXNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAobWF0Y2hlc1tpXS5jb2RlID09ICdYJykge1xuICAgICAgICAgICAgICAgIG1hdGNoZXNbaV0uYXJndW1lbnQgPSBTdHJpbmcoTWF0aC5hYnMocGFyc2VJbnQobWF0Y2hlc1tpXS5hcmd1bWVudCkpLnRvU3RyaW5nKDE2KSk7XG4gICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gdGhpcy5fY29udmVydChtYXRjaGVzW2ldKS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gbWF0Y2hlc1tpXS5tYXRjaDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5ld1N0cmluZyArPSBzdHJpbmdzW2ldO1xuICAgICAgICAgICAgbmV3U3RyaW5nICs9IHN1YnN0aXR1dGlvbjtcbiAgICAgICAgfVxuICAgICAgICBuZXdTdHJpbmcgKz0gc3RyaW5nc1tpXTtcbiAgICAgICAgcmV0dXJuIG5ld1N0cmluZztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDpgY3ljoZba2V5LXZhbHVlXee7k+aehOeahG1hcFxuICAgICAqIEBwYXJhbSBtYXAgXG4gICAgICogQHBhcmFtIGNhbGxiYWNrIHJldHVybiB0dXVl77ya5Lit5pat5b6q546vXG4gICAgICovXG4gICAgc3RhdGljIGZvckVhY2hNYXAobWFwLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAoIW1hcCkgcmV0dXJuO1xuXG4gICAgICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMobWFwKTtcbiAgICAgICAga2V5cyA9IGtleXMuc29ydCgpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBrZXkgPSBrZXlzW2ldO1xuICAgICAgICAgICAgbGV0IHZhbHVlID0gbWFwW2tleV07XG5cbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKGtleSwgdmFsdWUpKSBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOmBjeWOhuaVsOaNrue7k+aehO+8jOi/lOWbnumVv+W6plxuICAgICAqIEBwYXJhbSBvYmog5pWw57uEIG9yIG9ialxuICAgICAqL1xuICAgIHN0YXRpYyBnZXRPYmpTaXplKG9iaikge1xuICAgICAgICBpZiAoIW9iaikge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG4gICAgICAgICAgICByZXR1cm4gb2JqLmxlbmd0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgIFRvb2xzLmZvckVhY2hNYXAob2JqLCAoaywgdikgPT4ge1xuICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjb3VudDtcbiAgICB9XG5cbiAgICBzdGF0aWMgZm9yZWFjaERpcihkaXIsIGNhbGxiYWNrLCBiTm90UmVjdXJzaW9uPykge1xuICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZGlyKSl7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi5om+5LiN5Yiw5oyH5a6a5paH5Lu25aS577yaXCIsZGlyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZzLnJlYWRkaXJTeW5jKGRpcikuZm9yRWFjaCgoZmlsZU5hbWUpID0+IHtcbiAgICAgICAgICAgIGlmIChmaWxlTmFtZS5zdGFydHNXaXRoKFwiflwiKSkge1xuICAgICAgICAgICAgICAgIC8vIOW/veeVpemakOiXj+aWh+S7tlxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHBhdGhOYW1lID0gcGF0aC5qb2luKGRpciwgZmlsZU5hbWUpO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmIChmcy5zdGF0U3luYyhwYXRoTmFtZSkuaXNEaXJlY3RvcnkoKSAmJiBiTm90UmVjdXJzaW9uICE9IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JlYWNoRGlyKHBhdGhOYW1lLCBjYWxsYmFjayxiTm90UmVjdXJzaW9uKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhwYXRoLm5vcm1hbGl6ZShwYXRoTmFtZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHN0YXRpYyBmb3JlYWNoRGlycyhkaXJzLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGlycykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJUb29scy5mb3JlYWNoRGlycyBkaXJzIG5vdCBhcnJheSFcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGxldCBkaXIgb2YgZGlycykge1xuICAgICAgICAgICAgdGhpcy5mb3JlYWNoRGlyKGRpciwgY2FsbGJhY2ssZmFsc2UpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5Yqg6L29eGxzeOaVsOaNrlxuICAgICAqIEBwYXJhbSB7Kn0gZmlsZVBhdGggXG4gICAgICogQHJldHVybiBbXG4gICAgICogICAgICBzaGVldE5hbWVzOiBzdHJpbmdbXSxcbiAgICAgKiAgICAgIHNoZWV0RGF0YXM6IHN0cmluZ1tdW10sXG4gICAgICogXVxuICAgICAqL1xuICAgIHN0YXRpYyBsb2FkUmF3RGF0YXNGcm9tWGxzeChmaWxlUGF0aCkge1xuICAgICAgICBsZXQgc2hlZXRzID0geGxzeC5wYXJzZShmaWxlUGF0aCk7XG5cbiAgICAgICAgbGV0IHJhd0RhdGFzID0gW107XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGVldHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHNoZWV0ID0gc2hlZXRzW2ldO1xuXG4gICAgICAgICAgICByYXdEYXRhcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBuYW1lOiBzaGVldC5uYW1lLFxuICAgICAgICAgICAgICAgIGRhdGE6IHNoZWV0LmRhdGEsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByYXdEYXRhcztcbiAgICB9XG4gICAgLyoqXG4gICAgICog6K6h566X5Lik5LiqcGF0aOeahOebuOWvueebruW9lVxuICAgICAqIOWmgu+8miBcbiAgICAgKiBwYXRoMSA9IEQ6XFx1ZGUyXFxwcmoudWxjb2Nvc2NyZWF0b3Jfc2FtcGxlMy41LjJcXGFzc2V0c1xcc2NyaXB0c1xcZ2FtZVxcdmlld1xccHJlZmFiX3Rlc3RcXFByZWZhYkJiLnRzXG4gICAgICogcGF0aDIgPSBEOlxcdWRlMlxccHJqLnVsY29jb3NjcmVhdG9yX3NhbXBsZTMuNS4yXFxhc3NldHNcXHNjcmlwdHNcXHVsZnJhbWV3b3JrXFx2aWV3XFxQcmVmYWJCYXNlLnRzXG4gICAgICogcmV0dXJuIC0+IC4uLy4uLy4uL3VsZnJhbWV3b3JrL3ZpZXdcbiAgICAgKi9cbiAgICBzdGF0aWMgY2FsY1JlbGF0aXZlUGF0aChwYXRoMSwgcGF0aDIpIHtcbiAgICAgICAgcGF0aDEgPSBwYXRoLm5vcm1hbGl6ZShwYXRoMSk7XG4gICAgICAgIHBhdGgyID0gcGF0aC5ub3JtYWxpemUocGF0aDIpO1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwicGF0aDEgPSBcIixwYXRoMSk7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJwYXRoMiA9IFwiLHBhdGgyKTtcbiAgICAgICAgLy8g5b2T5YmN5L2N572uXG4gICAgICAgIGxldCBhcnIxID0gcGF0aDEuc3BsaXQocGF0aC5zZXApO1xuICAgICAgICAvLyDnm67moIfkvY3nva5cbiAgICAgICAgbGV0IGFycjIgPSBwYXRoMi5zcGxpdChwYXRoLnNlcCk7XG5cbiAgICAgICAgbGV0IGFyciA9IFtdO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5taW4oYXJyMS5sZW5ndGgsIGFycjIubGVuZ3RoKTsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgZjEgPSBhcnIxW2ldO1xuICAgICAgICAgICAgbGV0IGYyID0gYXJyMltpXTtcblxuICAgICAgICAgICAgaWYgKGYxICE9IGYyKSB7XG4gICAgICAgICAgICAgICAgLy8g5bCG5b2T5YmN5L2N572u5Ymp5L2Z55qE5a2X5q615pu/5o2i5Li6IC4uXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IGkgKyAxOyBqIDwgYXJyMS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChcIi4uXCIpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIOWwhuebruagh+S9jee9ruWJqeS9meeahOWtl+auteWOi+agiFxuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSBpOyBqIDwgYXJyMi5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChhcnIyW2pdKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihhcnIubGVuZ3RoID09IDEpe1xuICAgICAgICAgICAgcmV0dXJuIFwiLi9cIiArIGFyclswXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXJyLmpvaW4ocGF0aC5zZXApO1xuICAgIH1cblxuICAgIHN0YXRpYyBmaW5kTGluZVRhZyhsaW5lcywgYmVnaW5UYWcsIGVuZFRhZykge1xuICAgICAgICBsZXQgaW5kZXgxID0gbnVsbDtcbiAgICAgICAgbGV0IGluZGV4MiA9IG51bGw7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgbGluZSA9IGxpbmVzW2ldLnRyaW0oKTtcbiAgICAgICAgICAgIGlmIChsaW5lID09IGJlZ2luVGFnKSB7XG4gICAgICAgICAgICAgICAgaW5kZXgxID0gaTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobGluZSA9PSBlbmRUYWcpIHtcbiAgICAgICAgICAgICAgICBpbmRleDIgPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFtpbmRleDEsIGluZGV4Ml1cbiAgICB9XG5cblxuICAgIHN0YXRpYyBsb2FkUmF3RGF0YXNGcm9tWGxzeEFzeW5jKGZpbGVQYXRoLCBjYikge1xuICAgICAgICBsZXQgcmF3RGF0YXMgPSB0aGlzLmxvYWRSYXdEYXRhc0Zyb21YbHN4KGZpbGVQYXRoKTtcbiAgICAgICAgY2IocmF3RGF0YXMpO1xuICAgIH1cblxuXG4gICAgLy8vLy8gdXVpZOebuOWFsyAvLy8vL1xuICAgIHN0YXRpYyBsb2FkVXVpZEZyb21NZXRhRmlsZVBhdGgobWV0YUZpbGVQYXRoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsZXQgdGV4dCA9IGZzLnJlYWRGaWxlU3luYyhtZXRhRmlsZVBhdGgsIHsgZW5jb2Rpbmc6IFwidXRmLThcIiB9KTtcbiAgICAgICAgICAgIGxldCBkYXRhID0gSlNPTi5wYXJzZSh0ZXh0KTtcbiAgICAgICAgICAgIHJldHVybiBkYXRhLnV1aWQ7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVG9vbHMubG9hZFV1aWRGcm9tTWV0YUZpbGVQYXRoIGhhcyBlcnJvclwiLCBlcnJvcik7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBjb21wcmVzc1V1aWQodXVpZCkge1xuICAgICAgICByZXR1cm4gVXVpZC5jb21wcmVzc1V1aWQodXVpZCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGRlY29tcHJlc3NVdWlkKHV1aWQpIHtcbiAgICAgICAgcmV0dXJuIFV1aWQuZGVjb21wcmVzc1V1aWQodXVpZCk7XG4gICAgfVxuXG59Il19