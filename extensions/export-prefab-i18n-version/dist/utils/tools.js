"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_extra_1 = __importDefault(require("fs-extra"));
const path_1 = __importDefault(require("path"));
const uuid_1 = __importDefault(require("./uuid"));
class Tools {
    static hello() {
        console.log("hello");
    }
    /**
     * 针对element进行排序
     * @param array
     * @param fields
     */
    static sortArrayByField(array, fields) {
        // 重载，允许只有一个字符串
        // cc.log("---typeof( fields )=",typeof( fields ))
        if (typeof (fields) == "string") {
            fields = [fields];
        }
        else {
            fields = fields;
        }
        // 处理一次fields
        let fieldConfig = [];
        for (let k in fields) {
            let v = fields[k];
            if (v && v != "") {
                // cc.log(v)
                if (v.substring(0, 1) === "-") {
                    let tmpField = v.substring(1, v.length);
                    if (tmpField && tmpField != "") {
                        fieldConfig.push([tmpField, true]);
                    }
                }
                else {
                    fieldConfig.push([v, false]);
                }
            }
        }
        // -- 按照优先级进行排序
        let sorter = (a, b) => {
            let ret = 0;
            for (let k in fieldConfig) {
                let v = fieldConfig[k];
                let field = v[0];
                let desc = v[1];
                let v1 = a[field];
                let v2 = b[field];
                if (v1 != null) {
                    if (desc) {
                        ret = v2 - v1;
                    }
                    else {
                        ret = v1 - v2;
                    }
                    if (ret != 0) {
                        return ret;
                    }
                }
            }
            return ret;
        };
        let sorted = [];
        for (let i = 0; i < array.length; i++) {
            const v = array[i];
            sorted.push(v);
        }
        sorted.sort(sorter);
        return sorted;
    }
    static _convert(match, nosign) {
        if (nosign) {
            match.sign = '';
        }
        else {
            match.sign = match.negative ? '-' : match.sign;
        }
        var l = match.min - match.argument.length + 1 - match.sign.length;
        var pad = new Array(l < 0 ? 0 : l).join(match.pad);
        if (!match.left) {
            if (match.pad == "0" || nosign) {
                return match.sign + pad + match.argument;
            }
            else {
                return pad + match.sign + match.argument;
            }
        }
        else {
            if (match.pad == "0" || nosign) {
                return match.sign + match.argument + pad.replace(/0/g, ' ');
            }
            else {
                return match.sign + match.argument + pad;
            }
        }
    }
    static format() {
        if (typeof arguments == "undefined") {
            return null;
        }
        if (arguments.length < 1) {
            return null;
        }
        if (typeof arguments[0] != "string") {
            return null;
        }
        if (typeof RegExp == "undefined") {
            return null;
        }
        var string = arguments[0];
        var exp = new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g);
        var matches = new Array();
        var strings = new Array();
        var convCount = 0;
        var stringPosStart = 0;
        var stringPosEnd = 0;
        var matchPosEnd = 0;
        var newString = '';
        var match = null;
        while (match = exp.exec(string)) {
            if (match[9]) {
                convCount += 1;
            }
            stringPosStart = matchPosEnd;
            stringPosEnd = exp.lastIndex - match[0].length;
            strings[strings.length] = string.substring(stringPosStart, stringPosEnd);
            matchPosEnd = exp.lastIndex;
            matches[matches.length] = {
                match: match[0],
                left: match[3] ? true : false,
                sign: match[4] || '',
                pad: match[5] || ' ',
                min: match[6] || 0,
                precision: match[8],
                code: match[9] || '%',
                negative: parseInt(arguments[convCount]) < 0 ? true : false,
                argument: String(arguments[convCount])
            };
        }
        strings[strings.length] = string.substring(matchPosEnd);
        if (matches.length == 0) {
            return string;
        }
        if ((arguments.length - 1) < convCount) {
            return null;
        }
        var code = null;
        var match = null;
        var substitution = null;
        var i = null;
        for (i = 0; i < matches.length; i++) {
            if (matches[i].code == '%') {
                substitution = '%';
            }
            else if (matches[i].code == 'b') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)).toString(2));
                substitution = this._convert(matches[i], true);
            }
            else if (matches[i].code == 'c') {
                matches[i].argument = String(String.fromCharCode(Math.abs(parseInt(matches[i].argument))));
                substitution = this._convert(matches[i], true);
            }
            else if (matches[i].code == 'd') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)));
                substitution = this._convert(matches[i]);
            }
            else if (matches[i].code == 'f') {
                matches[i].argument = String(Math.abs(parseFloat(matches[i].argument)).toFixed(matches[i].precision ? matches[i].precision : 6));
                substitution = this._convert(matches[i]);
            }
            else if (matches[i].code == 'o') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)).toString(8));
                substitution = this._convert(matches[i]);
            }
            else if (matches[i].code == 's') {
                matches[i].argument = matches[i].argument.substring(0, matches[i].precision ? matches[i].precision : matches[i].argument.length);
                substitution = this._convert(matches[i], true);
            }
            else if (matches[i].code == 'x') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)).toString(16));
                substitution = this._convert(matches[i]);
            }
            else if (matches[i].code == 'X') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)).toString(16));
                substitution = this._convert(matches[i]).toUpperCase();
            }
            else {
                substitution = matches[i].match;
            }
            newString += strings[i];
            newString += substitution;
        }
        newString += strings[i];
        return newString;
    }
    /**
     * 遍历[key-value]结构的map
     * @param map
     * @param callback return tuue：中断循环
     */
    static forEachMap(map, callback, bSortKey) {
        if (!map)
            return;
        let keys = Object.keys(map);
        if (bSortKey) {
            keys = keys.sort();
        }
        for (let i = 0; i < keys.length; i++) {
            const key = keys[i];
            const value = map[key];
            if (value != null) {
                if (callback(key, value))
                    break;
            }
        }
    }
    /**
     * 遍历数据结构，返回长度
     * @param obj 数组 or obj
     */
    static getObjSize(obj) {
        if (!obj) {
            return 0;
        }
        if (Array.isArray(obj)) {
            return obj.length;
        }
        let count = 0;
        Tools.forEachMap(obj, (k, v) => {
            count++;
        });
        return count;
    }
    static foreachDir(dir, callback, bNotRecursion) {
        if (!fs_extra_1.default.existsSync(dir)) {
            console.error("找不到指定文件夹：", dir);
            return;
        }
        fs_extra_1.default.readdirSync(dir).forEach((fileName) => {
            if (fileName.startsWith("~")) {
                // 忽略隐藏文件
                return;
            }
            let pathName = path_1.default.join(dir, fileName);
            try {
                if (fs_extra_1.default.statSync(pathName).isDirectory() && bNotRecursion != true) {
                    this.foreachDir(pathName, callback, bNotRecursion);
                }
                else {
                    callback(path_1.default.normalize(pathName));
                }
            }
            catch (error) {
                console.error(error);
            }
        });
    }
    static foreachDirs(dirs, callback) {
        if (!Array.isArray(dirs)) {
            console.error("Tools.foreachDirs dirs not array!");
            return;
        }
        for (let dir of dirs) {
            this.foreachDir(dir, callback, false);
        }
    }
    /**
     * 计算两个path的相对目录
     */
    static calcRelativePath(path1, path2) {
        path1 = path_1.default.normalize(path1);
        path2 = path_1.default.normalize(path2);
        //console.log("path1 = ",path1);
        //console.log("path2 = ",path2);
        // 当前位置
        let arr1 = path1.split(path_1.default.sep);
        // 目标位置
        let arr2 = path2.split(path_1.default.sep);
        let arr = [];
        for (let i = 0; i < Math.min(arr1.length, arr2.length); i++) {
            let f1 = arr1[i];
            let f2 = arr2[i];
            if (f1 != f2) {
                // 将当前位置剩余的字段替换为 ..
                for (let j = i + 1; j < arr1.length; j++) {
                    arr.push("..");
                }
                // 将目标位置剩余的字段压栈
                for (let j = i; j < arr2.length; j++) {
                    arr.push(arr2[j]);
                }
                break;
            }
        }
        if (arr.length == 1) {
            return "./" + arr[0];
        }
        return arr.join(path_1.default.sep);
    }
    static findLineTag(lines, beginTag, endTag) {
        let index1 = null;
        let index2 = null;
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line == beginTag) {
                index1 = i;
            }
            else if (line == endTag) {
                index2 = i;
            }
        }
        return [index1, index2];
    }
    ///// uuid相关 /////
    static loadUuidFromMetaFilePath(metaFilePath) {
        try {
            let text = fs_extra_1.default.readFileSync(metaFilePath, { encoding: "utf-8" });
            let data = JSON.parse(text);
            return data.uuid;
        }
        catch (error) {
            console.error("Tools.loadUuidFromMetaFilePath has error", error);
            return null;
        }
    }
    static compressUuid(uuid) {
        return uuid_1.default.compressUuid(uuid);
    }
    static decompressUuid(uuid) {
        return uuid_1.default.decompressUuid(uuid);
    }
}
exports.default = Tools;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvdXRpbHMvdG9vbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSx3REFBMEI7QUFDMUIsZ0RBQXdCO0FBQ3hCLGtEQUEwQjtBQUcxQixNQUFxQixLQUFLO0lBQ3RCLE1BQU0sQ0FBQyxLQUFLO1FBQ1IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUN4QixDQUFDO0lBSUQ7Ozs7T0FJRztJQUNILE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsTUFBTTtRQUNqQyxlQUFlO1FBQ2Ysa0RBQWtEO1FBQ2xELElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLFFBQVEsRUFBRTtZQUM3QixNQUFNLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNyQjthQUFNO1lBQ0gsTUFBTSxHQUFHLE1BQU0sQ0FBQztTQUNuQjtRQUVELGFBQWE7UUFDYixJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFDckIsS0FBSyxJQUFJLENBQUMsSUFBSSxNQUFNLEVBQUU7WUFDbEIsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEVBQUU7Z0JBQ2QsWUFBWTtnQkFDWixJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLEdBQUcsRUFBRTtvQkFDM0IsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUN4QyxJQUFJLFFBQVEsSUFBSSxRQUFRLElBQUksRUFBRSxFQUFFO3dCQUM1QixXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7cUJBQ3RDO2lCQUNKO3FCQUNJO29CQUNELFdBQVcsQ0FB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Q0FBQyxDQUFDO2FBQ2Q7U0FDSjtRQUVELE9BQU8sQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFDM0IsQ0FBQztJQUdELGtCQUFrQjtJQUNsQixNQUFNLENBQUMsd0JBQXdCLENBQUMsWUFBWTtRQUN4QyxJQUFJO1lBQ0EsSUFBSSxJQUFJLEdBQUcsa0JBQUUsQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDaEUsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1QixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDcEI7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNaLE9BQU8sQ0FBQyxLQUFLLENBQUMsMENBQTBDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDakUsT0FBTyxJQUFJLENBQUM7U0FDZjtJQUNMLENBQUM7SUFFRCxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUk7UUFDcEIsT0FBTyxjQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFRCxNQUFNLENBQUMsY0FBYyxDQUFDLElBQUk7UUFDdEIsT0FBTyxjQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3JDLENBQUM7Q0FFSjtBQTNXRCx3QkEyV0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSBcImZzLWV4dHJhXCI7XHJcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XHJcbmltcG9ydCBVdWlkIGZyb20gXCIuL3V1aWRcIjtcclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUb29scyB7XHJcbiAgICBzdGF0aWMgaGVsbG8oKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJoZWxsb1wiKVxyXG4gICAgfVxyXG5cclxuICAgIFxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6ZKI5a+5ZWxlbWVudOi/m+ihjOaOkuW6j1xyXG4gICAgICogQHBhcmFtIGFycmF5IFxyXG4gICAgICogQHBhcmFtIGZpZWxkcyBcclxuICAgICAqL1xyXG4gICAgc3RhdGljIHNvcnRBcnJheUJ5RmllbGQoYXJyYXksIGZpZWxkcykge1xyXG4gICAgICAgIC8vIOmHjei9ve+8jOWFgeiuuOWPquacieS4gOS4quWtl+espuS4slxyXG4gICAgICAgIC8vIGNjLmxvZyhcIi0tLXR5cGVvZiggZmllbGRzICk9XCIsdHlwZW9mKCBmaWVsZHMgKSlcclxuICAgICAgICBpZiAodHlwZW9mIChmaWVsZHMpID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgZmllbGRzID0gW2ZpZWxkc107XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZmllbGRzID0gZmllbGRzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5aSE55CG5LiA5qyhZmllbGRzXHJcbiAgICAgICAgbGV0IGZpZWxkQ29uZmlnID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgayBpbiBmaWVsZHMpIHtcclxuICAgICAgICAgICAgbGV0IHYgPSBmaWVsZHNba107XHJcbiAgICAgICAgICAgIGlmICh2ICYmIHYgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgLy8gY2MubG9nKHYpXHJcbiAgICAgICAgICAgICAgICBpZiAodi5zdWJzdHJpbmcoMCwgMSkgPT09IFwiLVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHRtcEZpZWxkID0gdi5zdWJzdHJpbmcoMSwgdi5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0bXBGaWVsZCAmJiB0bXBGaWVsZCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkQ29uZmlnLnB1c2goW3RtcEZpZWxkLCB0cnVlXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGRDb25maWcucHVzaChbdiwgZmFsc2VdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gLS0g5oyJ54Wn5LyY5YWI57qn6L+b6KGM5o6S5bqPXHJcbiAgICAgICAgbGV0IHNvcnRlciA9IChhLCBiKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCByZXQgPSAwXHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCBrIGluIGZpZWxkQ29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdiA9IGZpZWxkQ29uZmlnW2tdO1xyXG4gICAgICAgICAgICAgICAgbGV0IGZpZWxkID0gdlswXTtcclxuICAgICAgICAgICAgICAgIGxldCBkZXNjID0gdlsxXTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgdjEgPSBhW2ZpZWxkXTtcclxuICAgICAgICAgICAgICAgIGxldCB2MiA9IGJbZmllbGRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHYxICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGVzYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXQgPSB2MiAtIHYxO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IHYxIC0gdjI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmV0ICE9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBzb3J0ZWQgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHYgPSBhcnJheVtpXTtcclxuICAgICAgICAgICAgc29ydGVkLnB1c2godik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNvcnRlZC5zb3J0KHNvcnRlcik7XHJcbiAgICAgICAgcmV0dXJuIHNvcnRlZFxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIF9jb252ZXJ0KG1hdGNoPywgbm9zaWduPykge1xyXG4gICAgICAgIGlmIChub3NpZ24pIHtcclxuICAgICAgICAgICAgbWF0Y2guc2lnbiA9ICcnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG1hdGNoLnNpZ24gPSBtYXRjaC5uZWdhdGl2ZSA/ICctJyA6IG1hdGNoLnNpZ247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBsID0gbWF0Y2gubWluIC0gbWF0Y2guYXJndW1lbnQubGVuZ3RoICsgMSAtIG1hdGNoLnNpZ24ubGVuZ3RoO1xyXG4gICAgICAgIHZhciBwYWQgPSBuZXcgQXJyYXkobCA8IDAgPyAwIDogbCkuam9pbihtYXRjaC5wYWQpO1xyXG4gICAgICAgIGlmICghbWF0Y2gubGVmdCkge1xyXG4gICAgICAgICAgICBpZiAobWF0Y2gucGFkID09IFwiMFwiIHx8IG5vc2lnbikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoLnNpZ24gKyBwYWQgKyBtYXRjaC5hcmd1bWVudDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwYWQgKyBtYXRjaC5zaWduICsgbWF0Y2guYXJndW1lbnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAobWF0Y2gucGFkID09IFwiMFwiIHx8IG5vc2lnbikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoLnNpZ24gKyBtYXRjaC5hcmd1bWVudCArIHBhZC5yZXBsYWNlKC8wL2csICcgJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2guc2lnbiArIG1hdGNoLmFyZ3VtZW50ICsgcGFkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC85byP5YyW5a2X56ym5LiyXHJcbiAgICAgKiBAcGFyYW0gYXJncyBj6aOO5qC855qEZm9ybWF05Y+C5pWw77yaZm9ybWF0KFwiJTAyZC0lc1wiLCAxLCBcImFcIilcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBmb3JtYXQoLi4uYXJncyk6IHN0cmluZztcclxuICAgIHB1YmxpYyBzdGF0aWMgZm9ybWF0KCk6IHN0cmluZyB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBhcmd1bWVudHMgPT0gXCJ1bmRlZmluZWRcIikgeyByZXR1cm4gbnVsbDsgfVxyXG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMSkgeyByZXR1cm4gbnVsbDsgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgYXJndW1lbnRzWzBdICE9IFwic3RyaW5nXCIpIHsgcmV0dXJuIG51bGw7IH1cclxuICAgICAgICBpZiAodHlwZW9mIFJlZ0V4cCA9PSBcInVuZGVmaW5lZFwiKSB7IHJldHVybiBudWxsOyB9XHJcbiAgICAgICAgdmFyIHN0cmluZyA9IGFyZ3VtZW50c1swXTtcclxuICAgICAgICB2YXIgZXhwID0gbmV3IFJlZ0V4cCgvKCUoWyVdfChcXC0pPyhcXCt8XFx4MjApPygwKT8oXFxkKyk/KFxcLihcXGQpPyk/KFtiY2Rmb3N4WF0pKSkvZyk7XHJcbiAgICAgICAgdmFyIG1hdGNoZXMgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICB2YXIgc3RyaW5ncyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIHZhciBjb252Q291bnQgPSAwO1xyXG4gICAgICAgIHZhciBzdHJpbmdQb3NTdGFydCA9IDA7XHJcbiAgICAgICAgdmFyIHN0cmluZ1Bvc0VuZCA9IDA7XHJcbiAgICAgICAgdmFyIG1hdGNoUG9zRW5kID0gMDtcclxuICAgICAgICB2YXIgbmV3U3RyaW5nID0gJyc7XHJcbiAgICAgICAgdmFyIG1hdGNoID0gbnVsbDtcclxuICAgICAgICB3aGlsZSAobWF0Y2ggPSBleHAuZXhlYyhzdHJpbmcpKSB7XHJcbiAgICAgICAgICAgIGlmIChtYXRjaFs5XSkgeyBjb252Q291bnQgKz0gMTsgfVxyXG4gICAgICAgICAgICBzdHJpbmdQb3NTdGFydCA9IG1hdGNoUG9zRW5kO1xyXG4gICAgICAgICAgICBzdHJpbmdQb3NFbmQgPSBleHAubGFzdEluZGV4IC0gbWF0Y2hbMF0ubGVuZ3RoO1xyXG4gICAgICAgICAgICBzdHJpbmdzW3N0cmluZ3MubGVuZ3RoXSA9IHN0cmluZy5zdWJzdHJpbmcoc3RyaW5nUG9zU3RhcnQsIHN0cmluZ1Bvc0VuZCk7XHJcbiAgICAgICAgICAgIG1hdGNoUG9zRW5kID0gZXhwLmxhc3RJbmRleDtcclxuICAgICAgICAgICAgbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aF0gPSB7XHJcbiAgICAgICAgICAgICAgICBtYXRjaDogbWF0Y2hbMF0sXHJcbiAgICAgICAgICAgICAgICBsZWZ0OiBtYXRjaFszXSA/IHRydWUgOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHNpZ246IG1hdGNoWzRdIHx8ICcnLFxyXG4gICAgICAgICAgICAgICAgcGFkOiBtYXRjaFs1XSB8fCAnICcsXHJcbiAgICAgICAgICAgICAgICBtaW46IG1hdGNoWzZdIHx8IDAsXHJcbiAgICAgICAgICAgICAgICBwcmVjaXNpb246IG1hdGNoWzhdLFxyXG4gICAgICAgICAgICAgICAgY29kZTogbWF0Y2hbOV0gfHwgJyUnLFxyXG4gICAgICAgICAgICAgICAgbmVnYXRpdmU6IHBhcnNlSW50KGFyZ3VtZW50c1tjb252Q291bnRdKSA8IDAgPyB0cnVlIDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBhcmd1bWVudDogU3RyaW5nKGFyZ3VtZW50c1tjb252Q291bnRdKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdHJpbmdzW3N0cmluZ3MubGVuZ3RoXSA9IHN0cmluZy5zdWJzdHJpbmcobWF0Y2hQb3NFbmQpO1xyXG4gICAgICAgIGlmIChtYXRjaGVzLmxlbmd0aCA9PSAwKSB7IHJldHVybiBzdHJpbmc7IH1cclxuICAgICAgICBpZiAoKGFyZ3VtZW50cy5sZW5ndGggLSAxKSA8IGNvbnZDb3VudCkgeyByZXR1cm4gbnVsbDsgfVxyXG4gICAgICAgIHZhciBjb2RlID0gbnVsbDtcclxuICAgICAgICB2YXIgbWF0Y2ggPSBudWxsO1xyXG4gICAgICAgIHZhciBzdWJzdGl0dXRpb24gPSBudWxsO1xyXG4gICAgICAgIHZhciBpID0gbnVsbDtcclxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbWF0Y2hlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAobWF0Y2hlc1tpXS5jb2RlID09ICclJykgeyBzdWJzdGl0dXRpb24gPSAnJScgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJ2InKSB7XHJcbiAgICAgICAgICAgICAgICBtYXRjaGVzW2ldLmFyZ3VtZW50ID0gU3RyaW5nKE1hdGguYWJzKHBhcnNlSW50KG1hdGNoZXNbaV0uYXJndW1lbnQpKS50b1N0cmluZygyKSk7XHJcbiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSB0aGlzLl9jb252ZXJ0KG1hdGNoZXNbaV0sIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKG1hdGNoZXNbaV0uY29kZSA9PSAnYycpIHtcclxuICAgICAgICAgICAgICAgIG1hdGNoZXNbaV0uYXJndW1lbnQgPSBTdHJpbmcoU3RyaW5nLmZyb21DaGFyQ29kZShNYXRoLmFicyhwYXJzZUludChtYXRjaGVzW2ldLmFyZ3VtZW50KSkpKTtcclxuICAgICAgICAgICAgICAgIHN1YnN0aXR1dGlvbiA9IHRoaXMuX2NvbnZlcnQobWF0Y2hlc1tpXSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAobWF0Y2hlc1tpXS5jb2RlID09ICdkJykge1xyXG4gICAgICAgICAgICAgICAgbWF0Y2hlc1tpXS5hcmd1bWVudCA9IFN0cmluZyhNYXRoLmFicyhwYXJzZUludChtYXRjaGVzW2ldLmFyZ3VtZW50KSkpO1xyXG4gICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gdGhpcy5fY29udmVydChtYXRjaGVzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJ2YnKSB7XHJcbiAgICAgICAgICAgICAgICBtYXRjaGVzW2ldLmFyZ3VtZW50ID0gU3RyaW5nKE1hdGguYWJzKHBhcnNlRmxvYXQobWF0Y2hlc1tpXS5hcmd1bWVudCkpLnRvRml4ZWQobWF0Y2hlc1tpXS5wcmVjaXNpb24gPyBtYXRjaGVzW2ldLnByZWNpc2lvbiA6IDYpKTtcclxuICAgICAgICAgICAgICAgIHN1YnN0aXR1dGlvbiA9IHRoaXMuX2NvbnZlcnQobWF0Y2hlc1tpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAobWF0Y2hlc1tpXS5jb2RlID09ICdvJykge1xyXG4gICAgICAgICAgICAgICAgbWF0Y2hlc1tpXS5hcmd1bWVudCA9IFN0cmluZyhNYXRoLmFicyhwYXJzZUludChtYXRjaGVzW2ldLmFyZ3VtZW50KSkudG9TdHJpbmcoOCkpO1xyXG4gICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gdGhpcy5fY29udmVydChtYXRjaGVzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJ3MnKSB7XHJcbiAgICAgICAgICAgICAgICBtYXRjaGVzW2ldLmFyZ3VtZW50ID0gbWF0Y2hlc1tpXS5hcmd1bWVudC5zdWJzdHJpbmcoMCwgbWF0Y2hlc1tpXS5wcmVjaXNpb24gPyBtYXRjaGVzW2ldLnByZWNpc2lvbiA6IG1hdGNoZXNbaV0uYXJndW1lbnQubGVuZ3RoKVxyXG4gICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gdGhpcy5fY29udmVydChtYXRjaGVzW2ldLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJ3gnKSB7XHJcbiAgICAgICAgICAgICAgICBtYXRjaGVzW2ldLmFyZ3VtZW50ID0gU3RyaW5nKE1hdGguYWJzKHBhcnNlSW50KG1hdGNoZXNbaV0uYXJndW1lbnQpKS50b1N0cmluZygxNikpO1xyXG4gICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gdGhpcy5fY29udmVydChtYXRjaGVzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJ1gnKSB7XHJcbiAgICAgICAgICAgICAgICBtYXRjaGVzW2ldLmFyZ3VtZW50ID0gU3RyaW5nKE1hdGguYWJzKHBhcnNlSW50KG1hdGNoZXNbaV0uYXJndW1lbnQpKS50b1N0cmluZygxNikpO1xyXG4gICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gdGhpcy5fY29udmVydChtYXRjaGVzW2ldKS50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gbWF0Y2hlc1tpXS5tYXRjaDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBuZXdTdHJpbmcgKz0gc3RyaW5nc1tpXTtcclxuICAgICAgICAgICAgbmV3U3RyaW5nICs9IHN1YnN0aXR1dGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbmV3U3RyaW5nICs9IHN0cmluZ3NbaV07XHJcbiAgICAgICAgcmV0dXJuIG5ld1N0cmluZztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmBjeWOhltrZXktdmFsdWVd57uT5p6E55qEbWFwXHJcbiAgICAgKiBAcGFyYW0gbWFwXHJcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgcmV0dXJuIHR1dWXvvJrkuK3mlq3lvqrnjq9cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBmb3JFYWNoTWFwPFRWYWx1ZT4obWFwOiB7IFtrOiBudW1iZXJdOiBUVmFsdWUgfSwgY2FsbGJhY2s6IChrZXk6IHN0cmluZywgdmFsdWU6IFRWYWx1ZSkgPT4gYm9vbGVhbiB8IHZvaWQsIGJTb3J0S2V5PzogYm9vbGVhbik6IHZvaWQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpgY3ljoZba2V5LXZhbHVlXee7k+aehOeahG1hcFxyXG4gICAgICogQHBhcmFtIG1hcFxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrIHJldHVybiB0dXVl77ya5Lit5pat5b6q546vXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZm9yRWFjaE1hcDxUVmFsdWU+KG1hcDogeyBbazogc3RyaW5nXTogVFZhbHVlIH0sIGNhbGxiYWNrOiAoa2V5OiBzdHJpbmcsIHZhbHVlOiBUVmFsdWUpID0+IGJvb2xlYW4gfCB2b2lkLCBiU29ydEtleT86IGJvb2xlYW4pOiB2b2lkO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YGN5Y6GW2tleS12YWx1ZV3nu5PmnoTnmoRtYXBcclxuICAgICAqIEBwYXJhbSBtYXBcclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayByZXR1cm4gdHV1Ze+8muS4reaWreW+queOr1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGZvckVhY2hNYXAobWFwOiBhbnksIGNhbGxiYWNrOiAoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpID0+IGJvb2xlYW4gfCB2b2lkLCBiU29ydEtleT86IGJvb2xlYW4pOiB2b2lkO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YGN5Y6GW2tleS12YWx1ZV3nu5PmnoTnmoRtYXBcclxuICAgICAqIEBwYXJhbSBtYXBcclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayByZXR1cm4gdHV1Ze+8muS4reaWreW+queOr1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGZvckVhY2hNYXA8VEtleSwgVFZhbHVlPihtYXA6IGFueSwgY2FsbGJhY2s6IChrZXk6IGFueSwgdmFsdWU6IGFueSkgPT4gYm9vbGVhbiB8IHZvaWQsIGJTb3J0S2V5PzogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgICAgIGlmICghbWFwKSByZXR1cm47XHJcblxyXG4gICAgICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMobWFwKTtcclxuICAgICAgICBpZiAoYlNvcnRLZXkpIHtcclxuICAgICAgICAgICAga2V5cyA9IGtleXMuc29ydCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBtYXBba2V5XTtcclxuXHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2soa2V5LCB2YWx1ZSkpIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YGN5Y6G5pWw5o2u57uT5p6E77yM6L+U5Zue6ZW/5bqmXHJcbiAgICAgKiBAcGFyYW0gb2JqIOaVsOe7hCBvciBvYmpcclxuICAgICAqL1xyXG4gICAgc3RhdGljIGdldE9ialNpemUob2JqKSB7XHJcbiAgICAgICAgaWYgKCFvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvYmoubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGNvdW50ID0gMDtcclxuICAgICAgICBUb29scy5mb3JFYWNoTWFwKG9iaiwgKGssIHYpID0+IHtcclxuICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gY291bnQ7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGZvcmVhY2hEaXIoZGlyLCBjYWxsYmFjaywgYk5vdFJlY3Vyc2lvbj8pIHtcclxuICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZGlyKSl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCLmib7kuI3liLDmjIflrprmlofku7blpLnvvJpcIixkaXIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmcy5yZWFkZGlyU3luYyhkaXIpLmZvckVhY2goKGZpbGVOYW1lKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmaWxlTmFtZS5zdGFydHNXaXRoKFwiflwiKSkge1xyXG4gICAgICAgICAgICAgICAgLy8g5b+955Wl6ZqQ6JeP5paH5Lu2XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxldCBwYXRoTmFtZSA9IHBhdGguam9pbihkaXIsIGZpbGVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZnMuc3RhdFN5bmMocGF0aE5hbWUpLmlzRGlyZWN0b3J5KCkgJiYgYk5vdFJlY3Vyc2lvbiAhPSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JlYWNoRGlyKHBhdGhOYW1lLCBjYWxsYmFjayxiTm90UmVjdXJzaW9uKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socGF0aC5ub3JtYWxpemUocGF0aE5hbWUpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGZvcmVhY2hEaXJzKGRpcnMsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRpcnMpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJUb29scy5mb3JlYWNoRGlycyBkaXJzIG5vdCBhcnJheSFcIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAobGV0IGRpciBvZiBkaXJzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZm9yZWFjaERpcihkaXIsIGNhbGxiYWNrLGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6K6h566X5Lik5LiqcGF0aOeahOebuOWvueebruW9lVxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY2FsY1JlbGF0aXZlUGF0aChwYXRoMSwgcGF0aDIpIHtcclxuICAgICAgICBwYXRoMSA9IHBhdGgubm9ybWFsaXplKHBhdGgxKTtcclxuICAgICAgICBwYXRoMiA9IHBhdGgubm9ybWFsaXplKHBhdGgyKTtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKFwicGF0aDEgPSBcIixwYXRoMSk7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcInBhdGgyID0gXCIscGF0aDIpO1xyXG4gICAgICAgIC8vIOW9k+WJjeS9jee9rlxyXG4gICAgICAgIGxldCBhcnIxID0gcGF0aDEuc3BsaXQocGF0aC5zZXApO1xyXG4gICAgICAgIC8vIOebruagh+S9jee9rlxyXG4gICAgICAgIGxldCBhcnIyID0gcGF0aDIuc3BsaXQocGF0aC5zZXApO1xyXG5cclxuICAgICAgICBsZXQgYXJyID0gW107XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5taW4oYXJyMS5sZW5ndGgsIGFycjIubGVuZ3RoKTsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBmMSA9IGFycjFbaV07XHJcbiAgICAgICAgICAgIGxldCBmMiA9IGFycjJbaV07XHJcblxyXG4gICAgICAgICAgICBpZiAoZjEgIT0gZjIpIHtcclxuICAgICAgICAgICAgICAgIC8vIOWwhuW9k+WJjeS9jee9ruWJqeS9meeahOWtl+auteabv+aNouS4uiAuLlxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IGkgKyAxOyBqIDwgYXJyMS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGFyci5wdXNoKFwiLi5cIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8g5bCG55uu5qCH5L2N572u5Ymp5L2Z55qE5a2X5q615Y6L5qCIXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gaTsgaiA8IGFycjIubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChhcnIyW2pdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZihhcnIubGVuZ3RoID09IDEpe1xyXG4gICAgICAgICAgICByZXR1cm4gXCIuL1wiICsgYXJyWzBdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYXJyLmpvaW4ocGF0aC5zZXApO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBmaW5kTGluZVRhZyhsaW5lcywgYmVnaW5UYWcsIGVuZFRhZykge1xyXG4gICAgICAgIGxldCBpbmRleDEgPSBudWxsO1xyXG4gICAgICAgIGxldCBpbmRleDIgPSBudWxsO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tpXS50cmltKCk7XHJcbiAgICAgICAgICAgIGlmIChsaW5lID09IGJlZ2luVGFnKSB7XHJcbiAgICAgICAgICAgICAgICBpbmRleDEgPSBpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGxpbmUgPT0gZW5kVGFnKSB7XHJcbiAgICAgICAgICAgICAgICBpbmRleDIgPSBpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gW2luZGV4MSwgaW5kZXgyXVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvLy8vLyB1dWlk55u45YWzIC8vLy8vXHJcbiAgICBzdGF0aWMgbG9hZFV1aWRGcm9tTWV0YUZpbGVQYXRoKG1ldGFGaWxlUGF0aCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGxldCB0ZXh0ID0gZnMucmVhZEZpbGVTeW5jKG1ldGFGaWxlUGF0aCwgeyBlbmNvZGluZzogXCJ1dGYtOFwiIH0pO1xyXG4gICAgICAgICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UodGV4dCk7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhLnV1aWQ7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlRvb2xzLmxvYWRVdWlkRnJvbU1ldGFGaWxlUGF0aCBoYXMgZXJyb3JcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGNvbXByZXNzVXVpZCh1dWlkKSB7XHJcbiAgICAgICAgcmV0dXJuIFV1aWQuY29tcHJlc3NVdWlkKHV1aWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBkZWNvbXByZXNzVXVpZCh1dWlkKSB7XHJcbiAgICAgICAgcmV0dXJuIFV1aWQuZGVjb21wcmVzc1V1aWQodXVpZCk7XHJcbiAgICB9XHJcblxyXG59Il19