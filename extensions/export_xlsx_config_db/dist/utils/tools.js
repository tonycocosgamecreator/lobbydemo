"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = __importDefault(require("fs"));
const path_1 = __importDefault(require("path"));
const node_xlsx_1 = __importDefault(require("node-xlsx"));
const uuid_1 = __importDefault(require("./uuid"));
class Tools {
    static hello() {
        console.log("hello");
    }
    /**
     * 针对element进行排序
     * @param array
     * @param fields
     */
    static sortArrayByField(array, fields) {
        // 重载，允许只有一个字符串
        // cc.log("---typeof( fields )=",typeof( fields ))
        if (typeof (fields) == "string") {
            fields = [fields];
        }
        else {
            fields = fields;
        }
        // 处理一次fields
        let fieldConfig = [];
        for (let k in fields) {
            let v = fields[k];
            if (v && v != "") {
                // cc.log(v)
                if (v.substring(0, 1) === "-") {
                    let tmpField = v.substring(1, v.length);
                    if (tmpField && tmpField != "") {
                        fieldConfig.push([tmpField, true]);
                    }
                }
                else {
                    fieldConfig.push([v, false]);
                }
            }
        }
        // -- 按照优先级进行排序
        let sorter = (a, b) => {
            let ret = 0;
            for (let k in fieldConfig) {
                let v = fieldConfig[k];
                let field = v[0];
                let desc = v[1];
                let v1 = a[field];
                let v2 = b[field];
                if (v1 != null) {
                    if (desc) {
                        ret = v2 - v1;
                    }
                    else {
                        ret = v1 - v2;
                    }
                    if (ret != 0) {
                        return ret;
                    }
                }
            }
            return ret;
        };
        let sorted = [];
        for (let i = 0; i < array.length; i++) {
            const v = array[i];
            sorted.push(v);
        }
        sorted.sort(sorter);
        return sorted;
    }
    static _convert(match, nosign) {
        if (nosign) {
            match.sign = '';
        }
        else {
            match.sign = match.negative ? '-' : match.sign;
        }
        var l = match.min - match.argument.length + 1 - match.sign.length;
        var pad = new Array(l < 0 ? 0 : l).join(match.pad);
        if (!match.left) {
            if (match.pad == "0" || nosign) {
                return match.sign + pad + match.argument;
            }
            else {
                return pad + match.sign + match.argument;
            }
        }
        else {
            if (match.pad == "0" || nosign) {
                return match.sign + match.argument + pad.replace(/0/g, ' ');
            }
            else {
                return match.sign + match.argument + pad;
            }
        }
    }
    static format() {
        if (typeof arguments == "undefined") {
            return null;
        }
        if (arguments.length < 1) {
            return null;
        }
        if (typeof arguments[0] != "string") {
            return null;
        }
        if (typeof RegExp == "undefined") {
            return null;
        }
        var string = arguments[0];
        var exp = new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g);
        var matches = new Array();
        var strings = new Array();
        var convCount = 0;
        var stringPosStart = 0;
        var stringPosEnd = 0;
        var matchPosEnd = 0;
        var newString = '';
        var match = null;
        while (match = exp.exec(string)) {
            if (match[9]) {
                convCount += 1;
            }
            stringPosStart = matchPosEnd;
            stringPosEnd = exp.lastIndex - match[0].length;
            strings[strings.length] = string.substring(stringPosStart, stringPosEnd);
            matchPosEnd = exp.lastIndex;
            matches[matches.length] = {
                match: match[0],
                left: match[3] ? true : false,
                sign: match[4] || '',
                pad: match[5] || ' ',
                min: match[6] || 0,
                precision: match[8],
                code: match[9] || '%',
                negative: parseInt(arguments[convCount]) < 0 ? true : false,
                argument: String(arguments[convCount])
            };
        }
        strings[strings.length] = string.substring(matchPosEnd);
        if (matches.length == 0) {
            return string;
        }
        if ((arguments.length - 1) < convCount) {
            return null;
        }
        var code = null;
        var match = null;
        var substitution = null;
        var i = null;
        for (i = 0; i < matches.length; i++) {
            if (matches[i].code == '%') {
                substitution = '%';
            }
            else if (matches[i].code == 'b') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)).toString(2));
                substitution = this._convert(matches[i], true);
            }
            else if (matches[i].code == 'c') {
                matches[i].argument = String(String.fromCharCode(Math.abs(parseInt(matches[i].argument))));
                substitution = this._convert(matches[i], true);
            }
            else if (matches[i].code == 'd') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)));
                substitution = this._convert(matches[i]);
            }
            else if (matches[i].code == 'f') {
                matches[i].argument = String(Math.abs(parseFloat(matches[i].argument)).toFixed(matches[i].precision ? matches[i].precision : 6));
                substitution = this._convert(matches[i]);
            }
            else if (matches[i].code == 'o') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)).toString(8));
                substitution = this._convert(matches[i]);
            }
            else if (matches[i].code == 's') {
                matches[i].argument = matches[i].argument.substring(0, matches[i].precision ? matches[i].precision : matches[i].argument.length);
                substitution = this._convert(matches[i], true);
            }
            else if (matches[i].code == 'x') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)).toString(16));
                substitution = this._convert(matches[i]);
            }
            else if (matches[i].code == 'X') {
                matches[i].argument = String(Math.abs(parseInt(matches[i].argument)).toString(16));
                substitution = this._convert(matches[i]).toUpperCase();
            }
            else {
                substitution = matches[i].match;
            }
            newString += strings[i];
            newString += substitution;
        }
        newString += strings[i];
        return newString;
    }
    /**
     * 遍历[key-value]结构的map
     * @param map
     * @param callback return tuue：中断循环
     */
    static forEachMap(map, callback, bSortKey) {
        if (!map)
            return;
        let keys = Object.keys(map);
        if (bSortKey) {
            keys = keys.sort();
        }
        for (let i = 0; i < keys.length; i++) {
            const key = keys[i];
            const value = map[key];
            if (value != null) {
                if (callback(key, value))
                    break;
            }
        }
    }
    /**
     * 遍历数据结构，返回长度
     * @param obj 数组 or obj
     */
    static getObjSize(obj) {
        if (!obj) {
            return 0;
        }
        if (Array.isArray(obj)) {
            return obj.length;
        }
        let count = 0;
        Tools.forEachMap(obj, (k, v) => {
            count++;
        });
        return count;
    }
    static foreachDir(dir, callback, bNotRecursion) {
        if (!fs_1.default.existsSync(dir)) {
            console.error("找不到指定文件夹：", dir);
            return;
        }
        fs_1.default.readdirSync(dir).forEach((fileName) => {
            if (fileName.startsWith("~")) {
                // 忽略隐藏文件
                return;
            }
            let pathName = path_1.default.join(dir, fileName);
            try {
                if (fs_1.default.statSync(pathName).isDirectory() && bNotRecursion != true) {
                    this.foreachDir(pathName, callback, bNotRecursion);
                }
                else {
                    callback(path_1.default.normalize(pathName));
                }
            }
            catch (error) {
                console.error(error);
            }
        });
    }
    static foreachDirs(dirs, callback) {
        if (!Array.isArray(dirs)) {
            console.error("Tools.foreachDirs dirs not array!");
            return;
        }
        for (let dir of dirs) {
            this.foreachDir(dir, callback, false);
        }
    }
    /**
     * 加载xlsx数据
     * @param {*} filePath
     * @return [
     *      sheetNames: string[],
     *      sheetDatas: string[][],
     * ]
     */
    static loadRawDatasFromXlsx(filePath) {
        let sheets = node_xlsx_1.default.parse(filePath);
        let rawDatas = [];
        for (let i = 0; i < sheets.length; i++) {
            const sheet = sheets[i];
            rawDatas.push({
                name: sheet.name,
                data: sheet.data,
            });
        }
        return rawDatas;
    }
    /**
     * 计算两个path的相对目录
     */
    static calcRelativePath(path1, path2) {
        path1 = path_1.default.normalize(path1);
        path2 = path_1.default.normalize(path2);
        //console.log("path1 = ",path1);
        //console.log("path2 = ",path2);
        // 当前位置
        let arr1 = path1.split(path_1.default.sep);
        // 目标位置
        let arr2 = path2.split(path_1.default.sep);
        let arr = [];
        for (let i = 0; i < Math.min(arr1.length, arr2.length); i++) {
            let f1 = arr1[i];
            let f2 = arr2[i];
            if (f1 != f2) {
                // 将当前位置剩余的字段替换为 ..
                for (let j = i + 1; j < arr1.length; j++) {
                    arr.push("..");
                }
                // 将目标位置剩余的字段压栈
                for (let j = i; j < arr2.length; j++) {
                    arr.push(arr2[j]);
                }
                break;
            }
        }
        if (arr.length == 1) {
            return "./" + arr[0];
        }
        return arr.join(path_1.default.sep);
    }
    static findLineTag(lines, beginTag, endTag) {
        let index1 = null;
        let index2 = null;
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line == beginTag) {
                index1 = i;
            }
            else if (line == endTag) {
                index2 = i;
            }
        }
        return [index1, index2];
    }
    static loadRawDatasFromXlsxAsync(filePath, cb) {
        let rawDatas = this.loadRawDatasFromXlsx(filePath);
        cb(rawDatas);
    }
    ///// uuid相关 /////
    static loadUuidFromMetaFilePath(metaFilePath) {
        try {
            let text = fs_1.default.readFileSync(metaFilePath, { encoding: "utf-8" });
            let data = JSON.parse(text);
            return data.uuid;
        }
        catch (error) {
            console.error("Tools.loadUuidFromMetaFilePath has error", error);
            return null;
        }
    }
    static compressUuid(uuid) {
        return uuid_1.default.compressUuid(uuid);
    }
    static decompressUuid(uuid) {
        return uuid_1.default.decompressUuid(uuid);
    }
    /**
     * 首字符大写
     * @param name
     */
    static upperFirstLetter(name) {
        return name.substring(0, 1).toUpperCase() + name.substring(1);
    }
}
exports.default = Tools;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvdXRpbHMvdG9vbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw0Q0FBb0I7QUFDcEIsZ0RBQXdCO0FBQ3hCLDBEQUE2QjtBQUM3QixrREFBMEI7QUFHMUIsTUFBcUIsS0FBSztJQUN0QixNQUFNLENBQUMsS0FBSztRQUNSLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDeEIsQ0FBQztJQUlEOzs7O09BSUc7SUFDSCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLE1BQU07UUFDakMsZUFBZTtRQUNmLGtEQUFrRDtRQUNsRCxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxRQUFRLEVBQUU7WUFDN0IsTUFBTSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDckI7YUFBTTtZQUNILE1BQU0sR0FBRyxNQUFNLENBQUM7U0FDbkI7UUFFRCxhQUFhO1FBQ2IsSUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLEtBQUssSUFBSSxDQUFDLElBQUksTUFBTSxFQUFFO1lBQ2xCLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFO2dCQUNkLFlBQVk7Z0JBQ1osSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxHQUFHLEVBQUU7b0JBQzNCLElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDeEMsSUFBSSxRQUFRLElBQUksUUFBUSxJQUFJLEVBQUUsRUFBRTt3QkFDNUIsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO3FCQUN0QztpQkFDSjtxQkFDSTtv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S0FBSyxDQUFDLDBDQUEwQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ2pFLE9BQU8sSUFBSSxDQUFDO1NBQ2Y7SUFDTCxDQUFDO0lBRUQsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJO1FBQ3BCLE9BQU8sY0FBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJO1FBQ3RCLE9BQU8sY0FBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQWE7UUFDeEMsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2pFLENBQUM7Q0FDSjtBQTdZRCx3QkE2WUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSBcImZzXCI7XHJcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XHJcbmltcG9ydCB4bHN4IGZyb20gXCJub2RlLXhsc3hcIjtcclxuaW1wb3J0IFV1aWQgZnJvbSBcIi4vdXVpZFwiO1xyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRvb2xzIHtcclxuICAgIHN0YXRpYyBoZWxsbygpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImhlbGxvXCIpXHJcbiAgICB9XHJcblxyXG4gICAgXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpkojlr7llbGVtZW506L+b6KGM5o6S5bqPXHJcbiAgICAgKiBAcGFyYW0gYXJyYXkgXHJcbiAgICAgKiBAcGFyYW0gZmllbGRzIFxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgc29ydEFycmF5QnlGaWVsZChhcnJheSwgZmllbGRzKSB7XHJcbiAgICAgICAgLy8g6YeN6L2977yM5YWB6K645Y+q5pyJ5LiA5Liq5a2X56ym5LiyXHJcbiAgICAgICAgLy8gY2MubG9nKFwiLS0tdHlwZW9mKCBmaWVsZHMgKT1cIix0eXBlb2YoIGZpZWxkcyApKVxyXG4gICAgICAgIGlmICh0eXBlb2YgKGZpZWxkcykgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBmaWVsZHMgPSBbZmllbGRzXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBmaWVsZHMgPSBmaWVsZHM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDlpITnkIbkuIDmrKFmaWVsZHNcclxuICAgICAgICBsZXQgZmllbGRDb25maWcgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBrIGluIGZpZWxkcykge1xyXG4gICAgICAgICAgICBsZXQgdiA9IGZpZWxkc1trXTtcclxuICAgICAgICAgICAgaWYgKHYgJiYgdiAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBjYy5sb2codilcclxuICAgICAgICAgICAgICAgIGlmICh2LnN1YnN0cmluZygwLCAxKSA9PT0gXCItXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdG1wRmllbGQgPSB2LnN1YnN0cmluZygxLCB2Lmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRtcEZpZWxkICYmIHRtcEZpZWxkICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRDb25maWcucHVzaChbdG1wRmllbGQsIHRydWVdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWVsZENvbmZpZy5wdXNoKFt2LCBmYWxzZV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyAtLSDmjInnhafkvJjlhYjnuqfov5vooYzmjpLluo9cclxuICAgICAgICBsZXQgc29ydGVyID0gKGEsIGIpID0+IHtcclxuICAgICAgICAgICAgbGV0IHJldCA9IDBcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGsgaW4gZmllbGRDb25maWcpIHtcclxuICAgICAgICAgICAgICAgIGxldCB2ID0gZmllbGRDb25maWdba107XHJcbiAgICAgICAgICAgICAgICBsZXQgZmllbGQgPSB2WzBdO1xyXG4gICAgICAgICAgICAgICAgbGV0IGRlc2MgPSB2WzFdO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCB2MSA9IGFbZmllbGRdO1xyXG4gICAgICAgICAgICAgICAgbGV0IHYyID0gYltmaWVsZF07XHJcbiAgICAgICAgICAgICAgICBpZiAodjEgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZXNjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IHYyIC0gdjE7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gdjEgLSB2MjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXQgIT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHNvcnRlZCA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgdiA9IGFycmF5W2ldO1xyXG4gICAgICAgICAgICBzb3J0ZWQucHVzaCh2KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc29ydGVkLnNvcnQoc29ydGVyKTtcclxuICAgICAgICByZXR1cm4gc29ydGVkXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgX2NvbnZlcnQobWF0Y2g/LCBub3NpZ24/KSB7XHJcbiAgICAgICAgaWYgKG5vc2lnbikge1xyXG4gICAgICAgICAgICBtYXRjaC5zaWduID0gJyc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbWF0Y2guc2lnbiA9IG1hdGNoLm5lZ2F0aXZlID8gJy0nIDogbWF0Y2guc2lnbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGwgPSBtYXRjaC5taW4gLSBtYXRjaC5hcmd1bWVudC5sZW5ndGggKyAxIC0gbWF0Y2guc2lnbi5sZW5ndGg7XHJcbiAgICAgICAgdmFyIHBhZCA9IG5ldyBBcnJheShsIDwgMCA/IDAgOiBsKS5qb2luKG1hdGNoLnBhZCk7XHJcbiAgICAgICAgaWYgKCFtYXRjaC5sZWZ0KSB7XHJcbiAgICAgICAgICAgIGlmIChtYXRjaC5wYWQgPT0gXCIwXCIgfHwgbm9zaWduKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2guc2lnbiArIHBhZCArIG1hdGNoLmFyZ3VtZW50O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhZCArIG1hdGNoLnNpZ24gKyBtYXRjaC5hcmd1bWVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChtYXRjaC5wYWQgPT0gXCIwXCIgfHwgbm9zaWduKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2guc2lnbiArIG1hdGNoLmFyZ3VtZW50ICsgcGFkLnJlcGxhY2UoLzAvZywgJyAnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaC5zaWduICsgbWF0Y2guYXJndW1lbnQgKyBwYWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLzlvI/ljJblrZfnrKbkuLJcclxuICAgICAqIEBwYXJhbSBhcmdzIGPpo47moLznmoRmb3JtYXTlj4LmlbDvvJpmb3JtYXQoXCIlMDJkLSVzXCIsIDEsIFwiYVwiKVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGZvcm1hdCguLi5hcmdzKTogc3RyaW5nO1xyXG4gICAgcHVibGljIHN0YXRpYyBmb3JtYXQoKTogc3RyaW5nIHtcclxuICAgICAgICBpZiAodHlwZW9mIGFyZ3VtZW50cyA9PSBcInVuZGVmaW5lZFwiKSB7IHJldHVybiBudWxsOyB9XHJcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxKSB7IHJldHVybiBudWxsOyB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBhcmd1bWVudHNbMF0gIT0gXCJzdHJpbmdcIikgeyByZXR1cm4gbnVsbDsgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgUmVnRXhwID09IFwidW5kZWZpbmVkXCIpIHsgcmV0dXJuIG51bGw7IH1cclxuICAgICAgICB2YXIgc3RyaW5nID0gYXJndW1lbnRzWzBdO1xyXG4gICAgICAgIHZhciBleHAgPSBuZXcgUmVnRXhwKC8oJShbJV18KFxcLSk/KFxcK3xcXHgyMCk/KDApPyhcXGQrKT8oXFwuKFxcZCk/KT8oW2JjZGZvc3hYXSkpKS9nKTtcclxuICAgICAgICB2YXIgbWF0Y2hlcyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIHZhciBzdHJpbmdzID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgdmFyIGNvbnZDb3VudCA9IDA7XHJcbiAgICAgICAgdmFyIHN0cmluZ1Bvc1N0YXJ0ID0gMDtcclxuICAgICAgICB2YXIgc3RyaW5nUG9zRW5kID0gMDtcclxuICAgICAgICB2YXIgbWF0Y2hQb3NFbmQgPSAwO1xyXG4gICAgICAgIHZhciBuZXdTdHJpbmcgPSAnJztcclxuICAgICAgICB2YXIgbWF0Y2ggPSBudWxsO1xyXG4gICAgICAgIHdoaWxlIChtYXRjaCA9IGV4cC5leGVjKHN0cmluZykpIHtcclxuICAgICAgICAgICAgaWYgKG1hdGNoWzldKSB7IGNvbnZDb3VudCArPSAxOyB9XHJcbiAgICAgICAgICAgIHN0cmluZ1Bvc1N0YXJ0ID0gbWF0Y2hQb3NFbmQ7XHJcbiAgICAgICAgICAgIHN0cmluZ1Bvc0VuZCA9IGV4cC5sYXN0SW5kZXggLSBtYXRjaFswXS5sZW5ndGg7XHJcbiAgICAgICAgICAgIHN0cmluZ3Nbc3RyaW5ncy5sZW5ndGhdID0gc3RyaW5nLnN1YnN0cmluZyhzdHJpbmdQb3NTdGFydCwgc3RyaW5nUG9zRW5kKTtcclxuICAgICAgICAgICAgbWF0Y2hQb3NFbmQgPSBleHAubGFzdEluZGV4O1xyXG4gICAgICAgICAgICBtYXRjaGVzW21hdGNoZXMubGVuZ3RoXSA9IHtcclxuICAgICAgICAgICAgICAgIG1hdGNoOiBtYXRjaFswXSxcclxuICAgICAgICAgICAgICAgIGxlZnQ6IG1hdGNoWzNdID8gdHJ1ZSA6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc2lnbjogbWF0Y2hbNF0gfHwgJycsXHJcbiAgICAgICAgICAgICAgICBwYWQ6IG1hdGNoWzVdIHx8ICcgJyxcclxuICAgICAgICAgICAgICAgIG1pbjogbWF0Y2hbNl0gfHwgMCxcclxuICAgICAgICAgICAgICAgIHByZWNpc2lvbjogbWF0Y2hbOF0sXHJcbiAgICAgICAgICAgICAgICBjb2RlOiBtYXRjaFs5XSB8fCAnJScsXHJcbiAgICAgICAgICAgICAgICBuZWdhdGl2ZTogcGFyc2VJbnQoYXJndW1lbnRzW2NvbnZDb3VudF0pIDwgMCA/IHRydWUgOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGFyZ3VtZW50OiBTdHJpbmcoYXJndW1lbnRzW2NvbnZDb3VudF0pXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN0cmluZ3Nbc3RyaW5ncy5sZW5ndGhdID0gc3RyaW5nLnN1YnN0cmluZyhtYXRjaFBvc0VuZCk7XHJcbiAgICAgICAgaWYgKG1hdGNoZXMubGVuZ3RoID09IDApIHsgcmV0dXJuIHN0cmluZzsgfVxyXG4gICAgICAgIGlmICgoYXJndW1lbnRzLmxlbmd0aCAtIDEpIDwgY29udkNvdW50KSB7IHJldHVybiBudWxsOyB9XHJcbiAgICAgICAgdmFyIGNvZGUgPSBudWxsO1xyXG4gICAgICAgIHZhciBtYXRjaCA9IG51bGw7XHJcbiAgICAgICAgdmFyIHN1YnN0aXR1dGlvbiA9IG51bGw7XHJcbiAgICAgICAgdmFyIGkgPSBudWxsO1xyXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBtYXRjaGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJyUnKSB7IHN1YnN0aXR1dGlvbiA9ICclJyB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKG1hdGNoZXNbaV0uY29kZSA9PSAnYicpIHtcclxuICAgICAgICAgICAgICAgIG1hdGNoZXNbaV0uYXJndW1lbnQgPSBTdHJpbmcoTWF0aC5hYnMocGFyc2VJbnQobWF0Y2hlc1tpXS5hcmd1bWVudCkpLnRvU3RyaW5nKDIpKTtcclxuICAgICAgICAgICAgICAgIHN1YnN0aXR1dGlvbiA9IHRoaXMuX2NvbnZlcnQobWF0Y2hlc1tpXSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAobWF0Y2hlc1tpXS5jb2RlID09ICdjJykge1xyXG4gICAgICAgICAgICAgICAgbWF0Y2hlc1tpXS5hcmd1bWVudCA9IFN0cmluZyhTdHJpbmcuZnJvbUNoYXJDb2RlKE1hdGguYWJzKHBhcnNlSW50KG1hdGNoZXNbaV0uYXJndW1lbnQpKSkpO1xyXG4gICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gdGhpcy5fY29udmVydChtYXRjaGVzW2ldLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJ2QnKSB7XHJcbiAgICAgICAgICAgICAgICBtYXRjaGVzW2ldLmFyZ3VtZW50ID0gU3RyaW5nKE1hdGguYWJzKHBhcnNlSW50KG1hdGNoZXNbaV0uYXJndW1lbnQpKSk7XHJcbiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSB0aGlzLl9jb252ZXJ0KG1hdGNoZXNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKG1hdGNoZXNbaV0uY29kZSA9PSAnZicpIHtcclxuICAgICAgICAgICAgICAgIG1hdGNoZXNbaV0uYXJndW1lbnQgPSBTdHJpbmcoTWF0aC5hYnMocGFyc2VGbG9hdChtYXRjaGVzW2ldLmFyZ3VtZW50KSkudG9GaXhlZChtYXRjaGVzW2ldLnByZWNpc2lvbiA/IG1hdGNoZXNbaV0ucHJlY2lzaW9uIDogNikpO1xyXG4gICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gdGhpcy5fY29udmVydChtYXRjaGVzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChtYXRjaGVzW2ldLmNvZGUgPT0gJ28nKSB7XHJcbiAgICAgICAgICAgICAgICBtYXRjaGVzW2ldLmFyZ3VtZW50ID0gU3RyaW5nKE1hdGguYWJzKHBhcnNlSW50KG1hdGNoZXNbaV0uYXJndW1lbnQpKS50b1N0cmluZyg4KSk7XHJcbiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSB0aGlzLl9jb252ZXJ0KG1hdGNoZXNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKG1hdGNoZXNbaV0uY29kZSA9PSAncycpIHtcclxuICAgICAgICAgICAgICAgIG1hdGNoZXNbaV0uYXJndW1lbnQgPSBtYXRjaGVzW2ldLmFyZ3VtZW50LnN1YnN0cmluZygwLCBtYXRjaGVzW2ldLnByZWNpc2lvbiA/IG1hdGNoZXNbaV0ucHJlY2lzaW9uIDogbWF0Y2hlc1tpXS5hcmd1bWVudC5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSB0aGlzLl9jb252ZXJ0KG1hdGNoZXNbaV0sIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKG1hdGNoZXNbaV0uY29kZSA9PSAneCcpIHtcclxuICAgICAgICAgICAgICAgIG1hdGNoZXNbaV0uYXJndW1lbnQgPSBTdHJpbmcoTWF0aC5hYnMocGFyc2VJbnQobWF0Y2hlc1tpXS5hcmd1bWVudCkpLnRvU3RyaW5nKDE2KSk7XHJcbiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSB0aGlzLl9jb252ZXJ0KG1hdGNoZXNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKG1hdGNoZXNbaV0uY29kZSA9PSAnWCcpIHtcclxuICAgICAgICAgICAgICAgIG1hdGNoZXNbaV0uYXJndW1lbnQgPSBTdHJpbmcoTWF0aC5hYnMocGFyc2VJbnQobWF0Y2hlc1tpXS5hcmd1bWVudCkpLnRvU3RyaW5nKDE2KSk7XHJcbiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSB0aGlzLl9jb252ZXJ0KG1hdGNoZXNbaV0pLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBtYXRjaGVzW2ldLm1hdGNoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5ld1N0cmluZyArPSBzdHJpbmdzW2ldO1xyXG4gICAgICAgICAgICBuZXdTdHJpbmcgKz0gc3Vic3RpdHV0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICBuZXdTdHJpbmcgKz0gc3RyaW5nc1tpXTtcclxuICAgICAgICByZXR1cm4gbmV3U3RyaW5nO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDpgY3ljoZba2V5LXZhbHVlXee7k+aehOeahG1hcFxyXG4gICAgICogQHBhcmFtIG1hcFxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrIHJldHVybiB0dXVl77ya5Lit5pat5b6q546vXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZm9yRWFjaE1hcDxUVmFsdWU+KG1hcDogeyBbazogbnVtYmVyXTogVFZhbHVlIH0sIGNhbGxiYWNrOiAoa2V5OiBzdHJpbmcsIHZhbHVlOiBUVmFsdWUpID0+IGJvb2xlYW4gfCB2b2lkLCBiU29ydEtleT86IGJvb2xlYW4pOiB2b2lkO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YGN5Y6GW2tleS12YWx1ZV3nu5PmnoTnmoRtYXBcclxuICAgICAqIEBwYXJhbSBtYXBcclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayByZXR1cm4gdHV1Ze+8muS4reaWreW+queOr1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGZvckVhY2hNYXA8VFZhbHVlPihtYXA6IHsgW2s6IHN0cmluZ106IFRWYWx1ZSB9LCBjYWxsYmFjazogKGtleTogc3RyaW5nLCB2YWx1ZTogVFZhbHVlKSA9PiBib29sZWFuIHwgdm9pZCwgYlNvcnRLZXk/OiBib29sZWFuKTogdm9pZDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOmBjeWOhltrZXktdmFsdWVd57uT5p6E55qEbWFwXHJcbiAgICAgKiBAcGFyYW0gbWFwXHJcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgcmV0dXJuIHR1dWXvvJrkuK3mlq3lvqrnjq9cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBmb3JFYWNoTWFwKG1hcDogYW55LCBjYWxsYmFjazogKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSA9PiBib29sZWFuIHwgdm9pZCwgYlNvcnRLZXk/OiBib29sZWFuKTogdm9pZDtcclxuICAgIC8qKlxyXG4gICAgICog6YGN5Y6GW2tleS12YWx1ZV3nu5PmnoTnmoRtYXBcclxuICAgICAqIEBwYXJhbSBtYXBcclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayByZXR1cm4gdHV1Ze+8muS4reaWreW+queOr1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGZvckVhY2hNYXA8VEtleSwgVFZhbHVlPihtYXA6IGFueSwgY2FsbGJhY2s6IChrZXk6IGFueSwgdmFsdWU6IGFueSkgPT4gYm9vbGVhbiB8IHZvaWQsIGJTb3J0S2V5PzogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgICAgIGlmICghbWFwKSByZXR1cm47XHJcblxyXG4gICAgICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMobWFwKTtcclxuICAgICAgICBpZiAoYlNvcnRLZXkpIHtcclxuICAgICAgICAgICAga2V5cyA9IGtleXMuc29ydCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBtYXBba2V5XTtcclxuXHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2soa2V5LCB2YWx1ZSkpIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YGN5Y6G5pWw5o2u57uT5p6E77yM6L+U5Zue6ZW/5bqmXHJcbiAgICAgKiBAcGFyYW0gb2JqIOaVsOe7hCBvciBvYmpcclxuICAgICAqL1xyXG4gICAgc3RhdGljIGdldE9ialNpemUob2JqKSB7XHJcbiAgICAgICAgaWYgKCFvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvYmoubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGNvdW50ID0gMDtcclxuICAgICAgICBUb29scy5mb3JFYWNoTWFwKG9iaiwgKGssIHYpID0+IHtcclxuICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gY291bnQ7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGZvcmVhY2hEaXIoZGlyLCBjYWxsYmFjaywgYk5vdFJlY3Vyc2lvbj8pIHtcclxuICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZGlyKSl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCLmib7kuI3liLDmjIflrprmlofku7blpLnvvJpcIixkaXIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmcy5yZWFkZGlyU3luYyhkaXIpLmZvckVhY2goKGZpbGVOYW1lKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmaWxlTmFtZS5zdGFydHNXaXRoKFwiflwiKSkge1xyXG4gICAgICAgICAgICAgICAgLy8g5b+955Wl6ZqQ6JeP5paH5Lu2XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxldCBwYXRoTmFtZSA9IHBhdGguam9pbihkaXIsIGZpbGVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZnMuc3RhdFN5bmMocGF0aE5hbWUpLmlzRGlyZWN0b3J5KCkgJiYgYk5vdFJlY3Vyc2lvbiAhPSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JlYWNoRGlyKHBhdGhOYW1lLCBjYWxsYmFjayxiTm90UmVjdXJzaW9uKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socGF0aC5ub3JtYWxpemUocGF0aE5hbWUpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGZvcmVhY2hEaXJzKGRpcnMsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRpcnMpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJUb29scy5mb3JlYWNoRGlycyBkaXJzIG5vdCBhcnJheSFcIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAobGV0IGRpciBvZiBkaXJzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZm9yZWFjaERpcihkaXIsIGNhbGxiYWNrLGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliqDovb14bHN45pWw5o2uXHJcbiAgICAgKiBAcGFyYW0geyp9IGZpbGVQYXRoIFxyXG4gICAgICogQHJldHVybiBbXHJcbiAgICAgKiAgICAgIHNoZWV0TmFtZXM6IHN0cmluZ1tdLFxyXG4gICAgICogICAgICBzaGVldERhdGFzOiBzdHJpbmdbXVtdLFxyXG4gICAgICogXVxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgbG9hZFJhd0RhdGFzRnJvbVhsc3goZmlsZVBhdGggOiBzdHJpbmcpIDoge25hbWUgOiBzdHJpbmcsZGF0YSA6IHN0cmluZ1tdW119W10ge1xyXG4gICAgICAgIGxldCBzaGVldHMgPSB4bHN4LnBhcnNlKGZpbGVQYXRoKTtcclxuXHJcbiAgICAgICAgbGV0IHJhd0RhdGFzIDoge25hbWUgOiBzdHJpbmcsZGF0YSA6IHN0cmluZ1tdW119W10gPSBbXTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGVldHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3Qgc2hlZXQgPSBzaGVldHNbaV07XHJcblxyXG4gICAgICAgICAgICByYXdEYXRhcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIG5hbWU6IHNoZWV0Lm5hbWUsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiBzaGVldC5kYXRhLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByYXdEYXRhcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6K6h566X5Lik5LiqcGF0aOeahOebuOWvueebruW9lVxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY2FsY1JlbGF0aXZlUGF0aChwYXRoMSwgcGF0aDIpIHtcclxuICAgICAgICBwYXRoMSA9IHBhdGgubm9ybWFsaXplKHBhdGgxKTtcclxuICAgICAgICBwYXRoMiA9IHBhdGgubm9ybWFsaXplKHBhdGgyKTtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKFwicGF0aDEgPSBcIixwYXRoMSk7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcInBhdGgyID0gXCIscGF0aDIpO1xyXG4gICAgICAgIC8vIOW9k+WJjeS9jee9rlxyXG4gICAgICAgIGxldCBhcnIxID0gcGF0aDEuc3BsaXQocGF0aC5zZXApO1xyXG4gICAgICAgIC8vIOebruagh+S9jee9rlxyXG4gICAgICAgIGxldCBhcnIyID0gcGF0aDIuc3BsaXQocGF0aC5zZXApO1xyXG5cclxuICAgICAgICBsZXQgYXJyID0gW107XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5taW4oYXJyMS5sZW5ndGgsIGFycjIubGVuZ3RoKTsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBmMSA9IGFycjFbaV07XHJcbiAgICAgICAgICAgIGxldCBmMiA9IGFycjJbaV07XHJcblxyXG4gICAgICAgICAgICBpZiAoZjEgIT0gZjIpIHtcclxuICAgICAgICAgICAgICAgIC8vIOWwhuW9k+WJjeS9jee9ruWJqeS9meeahOWtl+auteabv+aNouS4uiAuLlxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IGkgKyAxOyBqIDwgYXJyMS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGFyci5wdXNoKFwiLi5cIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8g5bCG55uu5qCH5L2N572u5Ymp5L2Z55qE5a2X5q615Y6L5qCIXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gaTsgaiA8IGFycjIubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChhcnIyW2pdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZihhcnIubGVuZ3RoID09IDEpe1xyXG4gICAgICAgICAgICByZXR1cm4gXCIuL1wiICsgYXJyWzBdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYXJyLmpvaW4ocGF0aC5zZXApO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBmaW5kTGluZVRhZyhsaW5lcywgYmVnaW5UYWcsIGVuZFRhZykge1xyXG4gICAgICAgIGxldCBpbmRleDEgPSBudWxsO1xyXG4gICAgICAgIGxldCBpbmRleDIgPSBudWxsO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tpXS50cmltKCk7XHJcbiAgICAgICAgICAgIGlmIChsaW5lID09IGJlZ2luVGFnKSB7XHJcbiAgICAgICAgICAgICAgICBpbmRleDEgPSBpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGxpbmUgPT0gZW5kVGFnKSB7XHJcbiAgICAgICAgICAgICAgICBpbmRleDIgPSBpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gW2luZGV4MSwgaW5kZXgyXVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBzdGF0aWMgbG9hZFJhd0RhdGFzRnJvbVhsc3hBc3luYyhmaWxlUGF0aCA6IHN0cmluZywgY2IgOiAocmF3RGF0YXMgOiB7bmFtZSA6IHN0cmluZyxkYXRhIDogc3RyaW5nW11bXX1bXSk9PnZvaWQpIHtcclxuICAgICAgICBsZXQgcmF3RGF0YXMgPSB0aGlzLmxvYWRSYXdEYXRhc0Zyb21YbHN4KGZpbGVQYXRoKTtcclxuICAgICAgICBjYihyYXdEYXRhcyk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8vLy8vIHV1aWTnm7jlhbMgLy8vLy9cclxuICAgIHN0YXRpYyBsb2FkVXVpZEZyb21NZXRhRmlsZVBhdGgobWV0YUZpbGVQYXRoKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgbGV0IHRleHQgPSBmcy5yZWFkRmlsZVN5bmMobWV0YUZpbGVQYXRoLCB7IGVuY29kaW5nOiBcInV0Zi04XCIgfSk7XHJcbiAgICAgICAgICAgIGxldCBkYXRhID0gSlNPTi5wYXJzZSh0ZXh0KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGEudXVpZDtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVG9vbHMubG9hZFV1aWRGcm9tTWV0YUZpbGVQYXRoIGhhcyBlcnJvclwiLCBlcnJvcik7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgY29tcHJlc3NVdWlkKHV1aWQpIHtcclxuICAgICAgICByZXR1cm4gVXVpZC5jb21wcmVzc1V1aWQodXVpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGRlY29tcHJlc3NVdWlkKHV1aWQpIHtcclxuICAgICAgICByZXR1cm4gVXVpZC5kZWNvbXByZXNzVXVpZCh1dWlkKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmmluWtl+espuWkp+WGmVxyXG4gICAgICogQHBhcmFtIG5hbWUgXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgdXBwZXJGaXJzdExldHRlcihuYW1lIDogc3RyaW5nKXtcclxuICAgICAgICByZXR1cm4gbmFtZS5zdWJzdHJpbmcoMCwxKS50b1VwcGVyQ2FzZSgpICsgbmFtZS5zdWJzdHJpbmcoMSk7XHJcbiAgICB9XHJcbn0iXX0=